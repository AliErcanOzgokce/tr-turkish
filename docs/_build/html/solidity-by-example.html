<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solidity by Example &mdash; Solidity 0.8.15 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/a4_railroad_diagram.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/toggle.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/js/toggle.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Solidity Kaynak Dosyasının Düzeni" href="layout-of-source-files.html" />
    <link rel="prev" title="Solidity Derleyicisini Yükleme" href="installing-solidity.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #65afff" >
            <a href="index.html">
            <img src="_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.8.15
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Temeller</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction-to-smart-contracts.html">Akıllı Sözleşmelere Giriş</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing-solidity.html">Solidity Derleyicisini Yükleme</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Solidity by Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#oylama">Oylama</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#olasi-iyilestirmeler">Olası İyileştirmeler</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gizli-ihale">Gizli İhale</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basit-acik-ihale">Basit Açık İhale</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Gizli İhale</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#guvenli-uzaktan-alisveris">Güvenli Uzaktan Alışveriş</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mikro-odeme-kanali">Mikro Ödeme Kanalı</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#imza-olusturma-ve-dogrulama">İmza Oluşturma ve Doğrulama</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#imza-olusturma">İmza oluşturma</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ne-imzalanacak">Ne İmzalanacak</a></li>
<li class="toctree-l4"><a class="reference internal" href="#argumanlari-paketleme">Argümanları Paketleme</a></li>
<li class="toctree-l4"><a class="reference internal" href="#solidity-de-imzalayani-bulma">Solidity’de İmzalayanı Bulma</a></li>
<li class="toctree-l4"><a class="reference internal" href="#imza-parametrelerini-cikartma">İmza Parametrelerini Çıkartma</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mesaj-hashini-hesaplama">Mesaj Hashini Hesaplama</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tam-kontrat">Tam Kontrat</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#basit-bir-odeme-kanali-yazmak">Basit Bir Ödeme Kanalı Yazmak</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#odeme-kanali-nedir">Ödeme Kanalı Nedir?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#odeme-kanalini-acma">Ödeme Kanalını Açma</a></li>
<li class="toctree-l4"><a class="reference internal" href="#odeme-gerceklestirme">Ödeme Gerçekleştirme</a></li>
<li class="toctree-l4"><a class="reference internal" href="#odeme-kanalini-kapatma">Ödeme Kanalını Kapatma</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kanalin-zaman-asimina-ugramasi">Kanalın Zaman Aşımına Uğraması</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">Tam Kontrat</a></li>
<li class="toctree-l4"><a class="reference internal" href="#odemeleri-dogrulama">Ödemeleri Doğrulama</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#moduler-kontratlar">Modüler Kontratlar</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Dil Açıklaması</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="layout-of-source-files.html">Solidity Kaynak Dosyasının Düzeni</a></li>
<li class="toctree-l1"><a class="reference internal" href="structure-of-a-contract.html">Bir Sözleşmenin Yapısı</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Türler</a></li>
<li class="toctree-l1"><a class="reference internal" href="units-and-global-variables.html">Birimler ve Global Olarak Kullanılabilir Değişkenler</a></li>
<li class="toctree-l1"><a class="reference internal" href="control-structures.html">İfadeler ve Kontrol Yapıları</a></li>
<li class="toctree-l1"><a class="reference internal" href="contracts.html">Akıllı Sözleşmeler</a></li>
<li class="toctree-l1"><a class="reference internal" href="assembly.html">Inline Assembly</a></li>
<li class="toctree-l1"><a class="reference internal" href="cheatsheet.html">Kopya Kağıdı</a></li>
<li class="toctree-l1"><a class="reference internal" href="grammar.html">Dilbilgisi (Language Grammar)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Derleyici</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="using-the-compiler.html">Derleyicinin Kullanımı</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysing-compilation-output.html">Analysing the Compiler Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="ir-breaking-changes.html">Solidity IR-based Codegen Changes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Dahili</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="internals/layout_in_storage.html">Depolama Alanındaki Durum Değişkenlerinin Düzeni</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals/layout_in_memory.html">Bellekteki Düzen</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals/layout_in_calldata.html">Çağrı Verilerinin Düzeni</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals/variable_cleanup.html">Değişkenlerin Temizlenmesi</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals/source_mappings.html">Kaynak Eşlemesi</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals/optimizer.html">Optimize Edici</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Sözleşme Meta Verisi</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html">Sözleşme ABI Spesifikasyonu</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Ek Materyaller</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="050-breaking-changes.html">Solidity v0.5.0 İşleyişi Bozan Değişiklikler</a></li>
<li class="toctree-l1"><a class="reference internal" href="060-breaking-changes.html">Solidity v0.6.0 İşleyişi Bozan Değişiklikler</a></li>
<li class="toctree-l1"><a class="reference internal" href="070-breaking-changes.html">Solidity v0.7.0 İşleyişi Bozan Değişiklikler</a></li>
<li class="toctree-l1"><a class="reference internal" href="080-breaking-changes.html">Solidity v0.8.0 İşleyişi Bozan Değişiklikler</a></li>
<li class="toctree-l1"><a class="reference internal" href="natspec-format.html">NatSpec Formatı</a></li>
<li class="toctree-l1"><a class="reference internal" href="security-considerations.html">Güvenlikle İlgili Değerlendirmeler</a></li>
<li class="toctree-l1"><a class="reference internal" href="smtchecker.html">SMTChecker and Formal Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Kaynaklar</a></li>
<li class="toctree-l1"><a class="reference internal" href="path-resolution.html">Import Path Resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="yul.html">Yul</a></li>
<li class="toctree-l1"><a class="reference internal" href="style-guide.html">Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-patterns.html">Sık Kullanılan Modeller</a></li>
<li class="toctree-l1"><a class="reference internal" href="bugs.html">Bilinen Bugların Listesi</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Katkıda Bulunmak</a></li>
<li class="toctree-l1"><a class="reference internal" href="brand-guide.html">Solidity Marka Kılavuzu</a></li>
<li class="toctree-l1"><a class="reference internal" href="language-influences.html">Language Influences</a></li>
</ul>

    <ul>
        <li>
            <a href="genindex.html">Keyword Index</a>
        </li>
    </ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #65afff" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Solidity</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Solidity by Example</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/solidity-by-example.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="solidity-by-example">
<h1>Solidity by Example<a class="headerlink" href="#solidity-by-example" title="Permalink to this heading"></a></h1>
<section id="oylama">
<span id="index-0"></span><span id="id1"></span><h2>Oylama<a class="headerlink" href="#oylama" title="Permalink to this heading"></a></h2>
<p>Birazdan göreceğiniz sözleşme biraz karışık ancak
Solidity’nin bir çok özelliğini görebilirsiniz.
Göreceğiniz kontrat bir oylama kontratıdır. Elektronik
oy kullanmada asıl problem oy hakkının doğru kişilere
nasıl verildiği ve manipülasyonun nasıl engelleneceğidir.
Bütün problemleri burada çözmeyeceğiz ama en azından
yetkilendirilmiş kişilerle hem otomatik hem de şeffaf
olarak nasıl oylama yapılacağını göstereceğiz.</p>
<p>Fikrimiz oy sandığı başına bir kontrat oluşturup her
seçenek için kısa isimler vermek. Sonrasında kontratın
yaratıcısı, aynı zamanda seçim başkanı oluyor, her cüzdana
tek tek oy hakkı verecek.</p>
<p>Sonrasında cüzdan sahipleri kendilerine ya da güvendikleri bir
kişiye oy verebilirler.</p>
<p>Oylamanın süresi dolduğunda, <code class="docutils literal notranslate"><span class="pre">winningProposal()</span></code> en yüksek
oyu almış teklifi geri döndürecek.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwovLy8gQHRpdGxlIFlldGtpbGkgT3lsYW1hCmNvbnRyYWN0IEJhbGxvdCB7CiAgICAvLyBCdSBzb25yYXPEsW5kYSBkZcSfacWfa2VuIG9sYXJhawogICAgLy8ga3VsbGFuxLFsbWFrIGnDp2luIG9sdcWfdHVydWxtdcWfIGtvbXBsZWtzIGJpciB0w7xyCiAgICAvLyBUZWsgYmlyIHNlw6dtZW5pIHRlbXNpbCBlZGVyCiAgICBzdHJ1Y3QgVm90ZXIgewogICAgICAgIHVpbnQgd2VpZ2h0OyAvLyBveXVuIHNlw6dpbWRla2kgZXRraSBhxJ/EsXJsxLHEn8SxCiAgICAgICAgYm9vbCB2b3RlZDsgIC8vIHRydWUgaXNlIG95IGt1bGxhbsSxbG3EscWfdMSxcgogICAgICAgIGFkZHJlc3MgZGVsZWdhdGU7IC8vIHlldGtpbGVuZGlyaWxlY2VrIGtpxZ9pbmluIGFkcmVzaQogICAgICAgIHVpbnQgdm90ZTsgICAvLyBveSB2ZXJpbG1pxZ8gcHJvcG9zYWzEsW4gaW5kZXggbnVtYXJhc8SxCiAgICB9CgogICAgLy8gVGVrbGkgdGVrbGlmIHTDvHLDvAogICAgc3RydWN0IFByb3Bvc2FsIHsKICAgICAgICBieXRlczMyIG5hbWU7ICAgLy8ga8Sxc2EgaXNtaSAoMzIgYmF5dGEga2FkYXIpCiAgICAgICAgdWludCB2b3RlQ291bnQ7IC8vIHRvcGxhbSBveSBtaWt0YXLEsQogICAgfQoKICAgIGFkZHJlc3MgcHVibGljIGNoYWlycGVyc29uOyAvLyBzZcOnaW0gYmHFn2thbsSxbsSxbiBhZHJlc2kKCiAgICAvLyBIZXIgYWRyZXMgacOnaW4gYFZvdGVyYCAoT3kga3VsbGFuYW4ga2nFn2kpCiAgICAvLyBzdHJ1Y3TEsW5hIG1hcHBpbmcgKGXFn2xlxZ90aXJtZSkgZGXEn2nFn2tlbmkKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBWb3RlcikgcHVibGljIHZvdGVyczsKCiAgICAvLyBgUHJvcG9zYWxgIHN0cnVjdGxhcsSxbmRhbiBvbHXFn2FuIGJpciBkaW5hbWlrIGRpemkgKGR5bmFtaWMgYXJyYXkpLgogICAgUHJvcG9zYWxbXSBwdWJsaWMgcHJvcG9zYWxzOwoKICAgIC8vLyBgcHJvcG9zYWxOYW1lc2BsZXJkZW4gYmlyaW5pIHNlw6dtZWsgacOnaW4gYmlyIG95IHNhbmTEscSfxLEgb2x1xZ90dXJ1ci4KICAgIGNvbnN0cnVjdG9yKGJ5dGVzMzJbXSBtZW1vcnkgcHJvcG9zYWxOYW1lcykgewogICAgICAgIGNoYWlycGVyc29uID0gbXNnLnNlbmRlcjsKICAgICAgICB2b3RlcnNbY2hhaXJwZXJzb25dLndlaWdodCA9IDE7CgogICAgICAgIC8vIEhlciB0ZWtsaWYgaXNtaSBpw6dpbiBiaXIgdGVrbGlmIG9iamVzaSBvbHXFn3R1cnVwCiAgICAgICAgLy8gZGl6aW5pbiAoYXJyYXkpIHNvbnVuYSBla2xlCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcHJvcG9zYWxOYW1lcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyBgUHJvcG9zYWwoey4uLn0pYCBnZcOnaWNpIGJpciBQcm9wb3NhbCAoVGVrbGlmKQogICAgICAgICAgICAvLyBvYmplc2kgb2x1xZ90dXJ1ciB2ZSBgcHJvcG9zYWxzLnB1c2goLi4uKWAKICAgICAgICAgICAgLy8gb2JqZXlpIGBwcm9wb3NhbHNgIGRpemlzaW5pbiBzb251bmEgZWtsZXIuCiAgICAgICAgICAgIHByb3Bvc2Fscy5wdXNoKFByb3Bvc2FsKHsKICAgICAgICAgICAgICAgIG5hbWU6IHByb3Bvc2FsTmFtZXNbaV0sCiAgICAgICAgICAgICAgICB2b3RlQ291bnQ6IDAKICAgICAgICAgICAgfSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBgdm90ZXJgYSBidSBzYW5kxLFrdGEgb3kga3VsbGFubWEgeWV0a2lzaSB2ZXIuCiAgICAvLyBgY2hhaXJwZXJzb25gIGJ1IGZvbmtzaXlvbnUgw6dhxJ/EsXJhYmlsaXIuCiAgICBmdW5jdGlvbiBnaXZlUmlnaHRUb1ZvdGUoYWRkcmVzcyB2b3RlcikgZXh0ZXJuYWwgewogICAgICAgIC8vIEXEn2VyIGByZXF1aXJlYMSxbiBpbGsgYXJnw7xtYW7EsSBgZmFsc2VgCiAgICAgICAgLy8gZ2VsaXJzZSBpxZ9sZW0gaXB0YWwgb2x1ciB2ZSBFdGhlcgogICAgICAgIC8vIGhhcmNhbWFsYXLEsSBlc2tpIGhhbGluZSBnZWxpcgogICAgICAgIC8vIEVza2lkZW4gYnUgZHVydW1kYSBiw7x0w7xuIGdhcyBoYXJjYW7EsXJkxLEKICAgICAgICAvLyBhbWEgYXJ0xLFrIGhhcmNhbm3EsXlvci4KICAgICAgICAvLyDDh2/En3UgemFtYW4gZm9ua3NpeW9udW4gZG/En3J1IMOnYcSfcsSxbMSxcAogICAgICAgIC8vIMOnYcSfcsSxbG1hZMSxxJ/EsW7EsSBhbmxhbWFrIGnDp2luIGByZXF1aXJlYAogICAgICAgIC8vIGt1bGxhbsSxbMSxcnNhIGl5aSBvbHVyCiAgICAgICAgLy8gxLBraW5jaSBhcmfDvG1hbiBvbGFyYWsgbmV5aW4gaGF0YWzEsSBvbGR1xJ91bnUKICAgICAgICAvLyBhw6fEsWtsYXlhbiBiaXIgeWF6xLEgZ2lyaWxlYmlsaXIuCiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjaGFpcnBlcnNvbiwKICAgICAgICAgICAgIlNhZGVjZSBjaGFpcnBlcnNvbiB5ZXRraSB2ZXJlYmlsaXIuIgogICAgICAgICk7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgIXZvdGVyc1t2b3Rlcl0udm90ZWQsCiAgICAgICAgICAgICJLacWfaSB6YXRlbiBveSBrdWxsYW5kxLEuIgogICAgICAgICk7CiAgICAgICAgcmVxdWlyZSh2b3RlcnNbdm90ZXJdLndlaWdodCA9PSAwKTsKICAgICAgICB2b3RlcnNbdm90ZXJdLndlaWdodCA9IDE7CiAgICB9CgogICAgLy8vIERlbGVnZSBgdG9gIGF0YS4KICAgIGZ1bmN0aW9uIGRlbGVnYXRlKGFkZHJlc3MgdG8pIGV4dGVybmFsIHsKICAgICAgICAvLyByZWZlcmFucyBhdGFyCiAgICAgICAgVm90ZXIgc3RvcmFnZSBzZW5kZXIgPSB2b3RlcnNbbXNnLnNlbmRlcl07CiAgICAgICAgcmVxdWlyZShzZW5kZXIud2VpZ2h0ICE9IDAsICJPeSB2ZXJtZSB5ZXRraW4geW9rIik7CiAgICAgICAgcmVxdWlyZSghc2VuZGVyLnZvdGVkLCAiWmF0ZW4gb3kga3VsbGFuZMSxbi4iKTsKCiAgICAgICAgcmVxdWlyZSh0byAhPSBtc2cuc2VuZGVyLCAiS2VuZGluaSB0ZW1zaWxjaSBnw7ZzdGVyZW1lenNpbi4iKTsKCiAgICAgICAgLy8gRGVsZWdlIGF0YW1hc8SxbsSxIGB0b2AgZGEgZGVsZWdlIGF0YW5kxLF5c2EKICAgICAgICAvLyBha3RhcsSxcgogICAgICAgIC8vIEdlbmVsZGUgYnUgdMO8ciBkw7ZuZ8O8bGVyIG9sZHVrw6dhIHRlaGxpa2VsaWRpciwKICAgICAgICAvLyDDp8O8bmvDvCBlxJ9lciDDp29rIGZhemxhIMOnYWzEscWfxLFybGFyc2EgYmxva3Rha2kKICAgICAgICAvLyBrdWxsYW7EsWxhYmlsaXIgZ2FzJ3RlbiBkYWhhIGZhemxhc8SxbmEgaWh0aXlhw6cgZHV5YWJpbGlyLgogICAgICAgIC8vIEJ1IGR1cnVtZGEsIGRlbGVnZSBhdGFtYSDDp2FsxLHFn21heWFjYWt0xLFyCiAgICAgICAgLy8gYW1hIGJhxZ9rYSBkdXJ1bWxhcmRhIGJ1IHTDvHIgZMO2bmfDvGxlcgogICAgICAgIC8vIGtvbnRyYXTEsW4gdGFtYW1peWxlIGtpdGxlbm1lc2luZSBzZWJlcCBvbGFiaWxpci4KICAgICAgICB3aGlsZSAodm90ZXJzW3RvXS5kZWxlZ2F0ZSAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIHRvID0gdm90ZXJzW3RvXS5kZWxlZ2F0ZTsKCiAgICAgICAgICAgIC8vIERlbGVnZSBhdGFtYWRhIGJpciBkw7ZuZ8O8IGJ1bGR1aywgYnVudSBpc3RlbWl5b3J1egogICAgICAgICAgICByZXF1aXJlKHRvICE9IG1zZy5zZW5kZXIsICJEZWxlZ2UgYXRhbWFkYSBkw7ZuZ8O8IGJ1bHVuZHUuIik7CiAgICAgICAgfQoKICAgICAgICBWb3RlciBzdG9yYWdlIGRlbGVnYXRlXyA9IHZvdGVyc1t0b107CgogICAgICAgIC8vIE95IGt1bGxhbmFuIGtpxZ9pIG95IGt1bGxhbmFtYXlhbiBracWfaWxlcmkgZGVsZWdlIGfDtnN0ZXJlbWV6LgogICAgICAgIHJlcXVpcmUoZGVsZWdhdGVfLndlaWdodCA+PSAxKTsKCiAgICAgICAgLy8gYHNlbmRlcmAgYmlyIHJlZmVyYW5zIG9sZHXEn3VuZGFuCiAgICAgICAgLy8gYHZvdGVyc1ttc2cuc2VuZGVyXWAgZGXEn2nFn2lyLgogICAgICAgIHNlbmRlci52b3RlZCA9IHRydWU7CiAgICAgICAgc2VuZGVyLmRlbGVnYXRlID0gdG87CgogICAgICAgIGlmIChkZWxlZ2F0ZV8udm90ZWQpIHsKICAgICAgICAgICAgLy8gRcSfZXIgZGVsZWdlIHphdGVuIG95bGFuZMSxeXNhCiAgICAgICAgICAgIC8vIG90b21hdGlrIG9sYXJhayBveWxhcmEgZWtsZW5pcgogICAgICAgICAgICBwcm9wb3NhbHNbZGVsZWdhdGVfLnZvdGVdLnZvdGVDb3VudCArPSBzZW5kZXIud2VpZ2h0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEXEn2VyIGRlbGVnZSBveWxhbm1hZMSxeXNhCiAgICAgICAgICAgIC8vIGHEn8SxcmzEscSfxLFuYSBla2xlbmlyLgogICAgICAgICAgICBkZWxlZ2F0ZV8ud2VpZ2h0ICs9IHNlbmRlci53ZWlnaHQ7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBPeSBrdWxsYW4gKHNhbmEgYXRhbm3EscWfIG95bGFyIGRhIGRhaGlsKQogICAgLy8vIHRla2xpZiBpc21pbmUgYHByb3Bvc2Fsc1twcm9wb3NhbF0ubmFtZWAuCiAgICBmdW5jdGlvbiB2b3RlKHVpbnQgcHJvcG9zYWwpIGV4dGVybmFsIHsKICAgICAgICBWb3RlciBzdG9yYWdlIHNlbmRlciA9IHZvdGVyc1ttc2cuc2VuZGVyXTsKICAgICAgICByZXF1aXJlKHNlbmRlci53ZWlnaHQgIT0gMCwgIk95IGt1bGxhbm1hIHlldGtpc2kgeW9rIik7CiAgICAgICAgcmVxdWlyZSghc2VuZGVyLnZvdGVkLCAiQWxyZWFkeSB2b3RlZC4iKTsKICAgICAgICBzZW5kZXIudm90ZWQgPSB0cnVlOwogICAgICAgIHNlbmRlci52b3RlID0gcHJvcG9zYWw7CgogICAgICAgIC8vIEXEn2VyIGBwcm9wb3NhbGAgZGl6aW5pbiBpw6dpbmRlIHlva3NhLAogICAgICAgIC8vIG90b21hdGlrIG9sYXJhayBiw7x0w7xuIGRlxJ9pxZ9pa2xpa2xlcgogICAgICAgIC8vIGVza2kgaGFsaW5lIGTDtm5lcgogICAgICAgIHByb3Bvc2Fsc1twcm9wb3NhbF0udm90ZUNvdW50ICs9IHNlbmRlci53ZWlnaHQ7CiAgICB9CgogICAgLy8vIEBkZXYgQsO8dMO8biBveWxhcsSxIGhlc2FwbGF5YXJhayBrYXphbmFuCiAgICAvLy8gdGVrbGlmaSBoZXNhcGxhcgogICAgZnVuY3Rpb24gd2lubmluZ1Byb3Bvc2FsKCkgcHVibGljIHZpZXcKICAgICAgICAgICAgcmV0dXJucyAodWludCB3aW5uaW5nUHJvcG9zYWxfKQogICAgewogICAgICAgIHVpbnQgd2lubmluZ1ZvdGVDb3VudCA9IDA7CiAgICAgICAgZm9yICh1aW50IHAgPSAwOyBwIDwgcHJvcG9zYWxzLmxlbmd0aDsgcCsrKSB7CiAgICAgICAgICAgIGlmIChwcm9wb3NhbHNbcF0udm90ZUNvdW50ID4gd2lubmluZ1ZvdGVDb3VudCkgewogICAgICAgICAgICAgICAgd2lubmluZ1ZvdGVDb3VudCA9IHByb3Bvc2Fsc1twXS52b3RlQ291bnQ7CiAgICAgICAgICAgICAgICB3aW5uaW5nUHJvcG9zYWxfID0gcDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBLYXphbmFuIHRla2xpZmluIGluZGVrcyBudW1hcmFzxLFuxLEgYnVsbWFrIGnDp2luCiAgICAvLyB3aW5uaW5nUHJvcG9zYWwoKSBmb25rc2l5b251bnUgw6dhxJ/EsXLEsXIgYXJkxLFuZGFuCiAgICAvLyBrYXphbmFuIHRla2xpZmluIGFkxLFuxLEgZMO2bmTDvHLDvHIuCiAgICBmdW5jdGlvbiB3aW5uZXJOYW1lKCkgZXh0ZXJuYWwgdmlldwogICAgICAgICAgICByZXR1cm5zIChieXRlczMyIHdpbm5lck5hbWVfKQogICAgewogICAgICAgIHdpbm5lck5hbWVfID0gcHJvcG9zYWxzW3dpbm5pbmdQcm9wb3NhbCgpXS5uYW1lOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="c1">/// @title Yetkili Oylama</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Ballot</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Bu sonrasında değişken olarak</span>
<span class="w">    </span><span class="c1">// kullanılmak için oluşturulmuş kompleks bir tür</span>
<span class="w">    </span><span class="c1">// Tek bir seçmeni temsil eder</span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Voter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">weight</span><span class="p">;</span><span class="w"> </span><span class="c1">// oyun seçimdeki etki ağırlığı</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">voted</span><span class="p">;</span><span class="w">  </span><span class="c1">// true ise oy kullanılmıştır</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">delegate</span><span class="p">;</span><span class="w"> </span><span class="c1">// yetkilendirilecek kişinin adresi</span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">vote</span><span class="p">;</span><span class="w">   </span><span class="c1">// oy verilmiş proposalın index numarası</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Tekli teklif türü</span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Proposal</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">name</span><span class="p">;</span><span class="w">   </span><span class="c1">// kısa ismi (32 bayta kadar)</span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">voteCount</span><span class="p">;</span><span class="w"> </span><span class="c1">// toplam oy miktarı</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">chairperson</span><span class="p">;</span><span class="w"> </span><span class="c1">// seçim başkanının adresi</span>

<span class="w">    </span><span class="c1">// Her adres için `Voter` (Oy kullanan kişi)</span>
<span class="w">    </span><span class="c1">// structına mapping (eşleştirme) değişkeni</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>Voter<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>voters<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// `Proposal` structlarından oluşan bir dinamik dizi (dynamic array).</span>
<span class="w">    </span>Proposal<span class="p">[]</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>proposals<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// `proposalNames`lerden birini seçmek için bir oy sandığı oluşturur.</span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">bytes32</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>proposalNames<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>chairperson<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>voters<span class="p">[</span>chairperson<span class="p">].</span>weight<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Her teklif ismi için bir teklif objesi oluşturup</span>
<span class="w">        </span><span class="c1">// dizinin (array) sonuna ekle</span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>proposalNames<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// `Proposal({...})` geçici bir Proposal (Teklif)</span>
<span class="w">            </span><span class="c1">// objesi oluşturur ve `proposals.push(...)`</span>
<span class="w">            </span><span class="c1">// objeyi `proposals` dizisinin sonuna ekler.</span>
<span class="w">            </span>proposals<span class="p">.</span>push<span class="p">(</span>Proposal<span class="p">({</span><span class="w"></span>
<span class="w">                </span>name<span class="p">:</span><span class="w"> </span>proposalNames<span class="p">[</span>i<span class="p">],</span><span class="w"></span>
<span class="w">                </span>voteCount<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="w"></span>
<span class="w">            </span><span class="p">}));</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// `voter`a bu sandıkta oy kullanma yetkisi ver.</span>
<span class="w">    </span><span class="c1">// `chairperson` bu fonksiyonu çağırabilir.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">giveRightToVote</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">voter</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Eğer `require`ın ilk argümanı `false`</span>
<span class="w">        </span><span class="c1">// gelirse işlem iptal olur ve Ether</span>
<span class="w">        </span><span class="c1">// harcamaları eski haline gelir</span>
<span class="w">        </span><span class="c1">// Eskiden bu durumda bütün gas harcanırdı</span>
<span class="w">        </span><span class="c1">// ama artık harcanmıyor.</span>
<span class="w">        </span><span class="c1">// Çoğu zaman fonksiyonun doğru çağrılıp</span>
<span class="w">        </span><span class="c1">// çağrılmadığını anlamak için `require`</span>
<span class="w">        </span><span class="c1">// kullanılırsa iyi olur</span>
<span class="w">        </span><span class="c1">// İkinci argüman olarak neyin hatalı olduğunu</span>
<span class="w">        </span><span class="c1">// açıklayan bir yazı girilebilir.</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>chairperson<span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;Sadece chairperson yetki verebilir.&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="o">!</span>voters<span class="p">[</span>voter<span class="p">].</span>voted<span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;Kişi zaten oy kullandı.&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>voters<span class="p">[</span>voter<span class="p">].</span>weight<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>voters<span class="p">[</span>voter<span class="p">].</span>weight<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Delege `to` ata.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">delegate</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// referans atar</span>
<span class="w">        </span>Voter<span class="w"> </span>storage<span class="w"> </span>sender<span class="w"> </span><span class="o">=</span><span class="w"> </span>voters<span class="p">[</span><span class="k">msg.sender</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>sender<span class="p">.</span>weight<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Oy verme yetkin yok&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="o">!</span>sender<span class="p">.</span>voted<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Zaten oy kullandın.&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">require</span><span class="p">(</span>to<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Kendini temsilci gösteremezsin.&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Delege atamasını `to` da delege atandıysa</span>
<span class="w">        </span><span class="c1">// aktarır</span>
<span class="w">        </span><span class="c1">// Genelde bu tür döngüler oldukça tehlikelidir,</span>
<span class="w">        </span><span class="c1">// çünkü eğer çok fazla çalışırlarsa bloktaki</span>
<span class="w">        </span><span class="c1">// kullanılabilir gas&#39;ten daha fazlasına ihtiyaç duyabilir.</span>
<span class="w">        </span><span class="c1">// Bu durumda, delege atama çalışmayacaktır</span>
<span class="w">        </span><span class="c1">// ama başka durumlarda bu tür döngüler</span>
<span class="w">        </span><span class="c1">// kontratın tamamiyle kitlenmesine sebep olabilir.</span>
<span class="w">        </span><span class="kt">while</span><span class="w"> </span><span class="p">(</span>voters<span class="p">[</span>to<span class="p">].</span>delegate<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>to<span class="w"> </span><span class="o">=</span><span class="w"> </span>voters<span class="p">[</span>to<span class="p">].</span>delegate<span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="c1">// Delege atamada bir döngü bulduk, bunu istemiyoruz</span>
<span class="w">            </span><span class="kt">require</span><span class="p">(</span>to<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Delege atamada döngü bulundu.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span>Voter<span class="w"> </span>storage<span class="w"> </span>delegate_<span class="w"> </span><span class="o">=</span><span class="w"> </span>voters<span class="p">[</span>to<span class="p">];</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Oy kullanan kişi oy kullanamayan kişileri delege gösteremez.</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>delegate_<span class="p">.</span>weight<span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// `sender` bir referans olduğundan</span>
<span class="w">        </span><span class="c1">// `voters[msg.sender]` değişir.</span>
<span class="w">        </span>sender<span class="p">.</span>voted<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>sender<span class="p">.</span>delegate<span class="w"> </span><span class="o">=</span><span class="w"> </span>to<span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>delegate_<span class="p">.</span>voted<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Eğer delege zaten oylandıysa</span>
<span class="w">            </span><span class="c1">// otomatik olarak oylara eklenir</span>
<span class="w">            </span>proposals<span class="p">[</span>delegate_<span class="p">.</span>vote<span class="p">].</span>voteCount<span class="w"> </span><span class="o">+=</span><span class="w"> </span>sender<span class="p">.</span>weight<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="kt">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Eğer delege oylanmadıysa</span>
<span class="w">            </span><span class="c1">// ağırlığına eklenir.</span>
<span class="w">            </span>delegate_<span class="p">.</span>weight<span class="w"> </span><span class="o">+=</span><span class="w"> </span>sender<span class="p">.</span>weight<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Oy kullan (sana atanmış oylar da dahil)</span>
<span class="w">    </span><span class="c1">/// teklif ismine `proposals[proposal].name`.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">vote</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">proposal</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>Voter<span class="w"> </span>storage<span class="w"> </span>sender<span class="w"> </span><span class="o">=</span><span class="w"> </span>voters<span class="p">[</span><span class="k">msg.sender</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>sender<span class="p">.</span>weight<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Oy kullanma yetkisi yok&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="o">!</span>sender<span class="p">.</span>voted<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Already voted.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>sender<span class="p">.</span>voted<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>sender<span class="p">.</span>vote<span class="w"> </span><span class="o">=</span><span class="w"> </span>proposal<span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Eğer `proposal` dizinin içinde yoksa,</span>
<span class="w">        </span><span class="c1">// otomatik olarak bütün değişiklikler</span>
<span class="w">        </span><span class="c1">// eski haline döner</span>
<span class="w">        </span>proposals<span class="p">[</span>proposal<span class="p">].</span>voteCount<span class="w"> </span><span class="o">+=</span><span class="w"> </span>sender<span class="p">.</span>weight<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// @dev Bütün oyları hesaplayarak kazanan</span>
<span class="w">    </span><span class="c1">/// teklifi hesaplar</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">winningProposal</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"></span>
<span class="w">            </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">winningProposal_</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">winningVoteCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>p<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>proposals<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>p<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>proposals<span class="p">[</span>p<span class="p">].</span>voteCount<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>winningVoteCount<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span>winningVoteCount<span class="w"> </span><span class="o">=</span><span class="w"> </span>proposals<span class="p">[</span>p<span class="p">].</span>voteCount<span class="p">;</span><span class="w"></span>
<span class="w">                </span>winningProposal_<span class="w"> </span><span class="o">=</span><span class="w"> </span>p<span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Kazanan teklifin indeks numarasını bulmak için</span>
<span class="w">    </span><span class="c1">// winningProposal() fonksiyonunu çağırır ardından</span>
<span class="w">    </span><span class="c1">// kazanan teklifin adını döndürür.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">winnerName</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"></span>
<span class="w">            </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">winnerName_</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>winnerName_<span class="w"> </span><span class="o">=</span><span class="w"> </span>proposals<span class="p">[</span>winningProposal<span class="p">()].</span>name<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<section id="olasi-iyilestirmeler">
<h3>Olası İyileştirmeler<a class="headerlink" href="#olasi-iyilestirmeler" title="Permalink to this heading"></a></h3>
<p>Şu an tüm katılımcılara yetki vermek için çok sayıda işlem
gerçekleştirilmesi gerekiyor. Daha iyi bir yöntem düşünebiliyor
musunuz?</p>
</section>
</section>
<section id="gizli-ihale">
<span id="index-1"></span><h2>Gizli İhale<a class="headerlink" href="#gizli-ihale" title="Permalink to this heading"></a></h2>
<p>Bu bölümde Ethereum’da tamamiyle gizli bir ihale kontratı oluşturmanın ne
kadar kolay olduğunu göstereceğiz. Önce herkesin başkalarının tekliflerini
görebildiği açık bir ihale kontratı oluşturup sonrasında ondan teklif süresi
dolana kadar kimsenin başkasının teklifini göremediği gizli bir ihale kontratı
oluşturacağız.</p>
<section id="basit-acik-ihale">
<span id="simple-auction"></span><h3>Basit Açık İhale<a class="headerlink" href="#basit-acik-ihale" title="Permalink to this heading"></a></h3>
<p>Aşağıdaki basit ihale kontratındaki fikir herkes teklif sürecinde teklfilerini
gönderebilcek. Teklifler yanında teklif verenlerin tekliflerine sadık kalmaları
için teklifte belirtilen parayı da içerecek. Eğer en yüksek teklif geçilirse önceki
en yüksek teklifi veren kişi parasını geri alacak. Teklif süreci bittiğinde kontratlar
kendi kendilerine çalışamadıklarından hak sahibi parasını almak için kontratı manuel olarak
çağırılmalıdır.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKY29udHJhY3QgU2ltcGxlQXVjdGlvbiB7CiAgICAvLyDEsGhhbGVuaW4gcGFyYW1ldHJlbGVyaS4gU8O8cmVsZXIgdW5peCB6YW1hbiBkYW1nYXPEsQogICAgLy8gKDE5NzAtMDEtMDEnZGVuIGl0aWJhcmVuIHNhbml5ZWxlcikgeWEgZGEgc2FuaXllCiAgICAvLyBjaW5zaW5kZW4gbmUga2FkYXIgc8O8cmVjZcSfaS4KICAgIGFkZHJlc3MgcGF5YWJsZSBwdWJsaWMgYmVuZWZpY2lhcnk7CiAgICB1aW50IHB1YmxpYyBhdWN0aW9uRW5kVGltZTsKCiAgICAvLyDEsGhhbGVuaW4gxZ91IGFuIGtpIGR1cnVtdQogICAgYWRkcmVzcyBwdWJsaWMgaGlnaGVzdEJpZGRlcjsKICAgIHVpbnQgcHVibGljIGhpZ2hlc3RCaWQ7CgogICAgLy8gw5ZuY2VraSB0ZWtsaWZsZXJkZW4gcGFyYSDDp2VrbWV5ZSBpemluIHZlcmlsZW5sZXIKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwZW5kaW5nUmV0dXJuczsKCiAgICAvLyBFbiBzb24gYHRydWVgeWEgw6dldmlyLCBoZXJoYW5naSBiaXIgZGXEn2nFn2lrbGlrIHlhcMSxbG1hc8SxbsSxIGVuZ2VsbGVyCiAgICAvLyB2YXJzYXnEsWxhbiBvbGFyYWsgYGZhbHNlYCB0YW7EsW1sYW7EsXIuCiAgICBib29sIGVuZGVkOwoKICAgIC8vIERlxJ9pxZ9pa2xpa2xlcmRlIHlhecSxbmxhbmFjYWsgRXZlbnQnbGVyCiAgICBldmVudCBIaWdoZXN0QmlkSW5jcmVhc2VkKGFkZHJlc3MgYmlkZGVyLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBBdWN0aW9uRW5kZWQoYWRkcmVzcyB3aW5uZXIsIHVpbnQgYW1vdW50KTsKCiAgICAvLyBCYcWfYXLEsXPEsXpsYXLEsSBhw6fEsWtsYXlhbiBoYXRhbGFyCgogICAgLy8gw5zDp2zDvCBlxJ9payDDp2l6Z2lsZXIgbmF0c3BlYyB5b3J1bWxhcsSxIG9sYXJhawogICAgLy8gYWRsYW5kxLFyxLFsxLFyLiBLdWxsYW7EsWPEsXlhIGJpciBpxZ9sZW1pIG9uYXlsYXlhY2HEn8SxCiAgICAvLyB6YW1hbiB5YSBkYSBiaXIgaGF0YWRhIGfDtnN0ZXJpbGlyLgoKICAgIC8vLyDEsGhhbGUgYml0dGkuCiAgICBlcnJvciBBdWN0aW9uQWxyZWFkeUVuZGVkKCk7CiAgICAvLy8gRcWfaXQgeWEgZGEgZGFoYSB5w7xrc2VrIGJpciB0ZWtsaWYgdmFyLgogICAgZXJyb3IgQmlkTm90SGlnaEVub3VnaCh1aW50IGhpZ2hlc3RCaWQpOwogICAgLy8vIFRla2xpZiBoZW7DvHogYml0bWVkaS4KICAgIGVycm9yIEF1Y3Rpb25Ob3RZZXRFbmRlZCgpOwogICAgLy8vIGF1Y3Rpb25FbmQgZm9ua3NpeW9udSB6YXRlbiDDp2HEn3LEsWxkxLEuCiAgICBlcnJvciBBdWN0aW9uRW5kQWxyZWFkeUNhbGxlZCgpOwoKICAgIC8vLyBIYWsgc2FoaWJpIGFkxLFuYSBgYmVuZWZpY2lhcnlBZGRyZXNzYAogICAgLy8vIGBiaWRkaW5nVGltZWAgZGFraSBzw7xyZSBpbGUgYmlyIGloYWxlIGJhxZ9sYXTEsXIuCiAgICBjb25zdHJ1Y3RvcigKICAgICAgICB1aW50IGJpZGRpbmdUaW1lLAogICAgICAgIGFkZHJlc3MgcGF5YWJsZSBiZW5lZmljaWFyeUFkZHJlc3MKICAgICkgewogICAgICAgIGJlbmVmaWNpYXJ5ID0gYmVuZWZpY2lhcnlBZGRyZXNzOwogICAgICAgIGF1Y3Rpb25FbmRUaW1lID0gYmxvY2sudGltZXN0YW1wICsgYmlkZGluZ1RpbWU7CiAgICB9CgogICAgLy8vIMSwxZ9sZW1sZSBiaXJsaWt0ZSB0ZWtsaWZ0ZWtpIHBhcmEgZGEKICAgIC8vLyBnw7ZuZGVyaWxpci4gw5ZkZW1lIHNhZGVjZSB0ZWtsaWYga2F6YW5tYXpzYQogICAgLy8vIGlhZGUgZWRpbGlyLgogICAgZnVuY3Rpb24gYmlkKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgLy8gSGVyaGFuZ2kgYmlyIGFyZ8O8bWFuYSBnZXJlayB5b2ssCiAgICAgICAgLy8gYsO8dMO8biBiaWxnaSB6YXRlbiBpxZ9sZW1pbiBwYXLDp2FzxLEuCiAgICAgICAgLy8gcGF5YWJsZSBhbmFodGFyIGtlbGltZXNpIGZvbmtzaXlvbnVuCiAgICAgICAgLy8gRXRoZXIgYWxhYmlsbWVzaSBpw6dpbiB6b3J1bmx1LgoKICAgICAgICAvLyB0ZWtsaWYgc8O8cmVjaSBiaXR0aXlzZSDDp2HEn3LEsXnEsQogICAgICAgIC8vIGdlcmkgw6dldmlyLgogICAgICAgIGlmIChibG9jay50aW1lc3RhbXAgPiBhdWN0aW9uRW5kVGltZSkKICAgICAgICAgICAgcmV2ZXJ0IEF1Y3Rpb25BbHJlYWR5RW5kZWQoKTsKICAgICAgICAvLyBUZWtsaWYgZGFoYSB5w7xrc2VrIGRlxJ9pbHNlLAogICAgICAgIC8vIHBhcmF5xLEgZ2VyaSBnw7ZuZGVyaW4gKHJldmVydCBpZmFkZXNpCiAgICAgICAgLy8gcGFyYXnEsSBhbG3EscWfIG9sbWFzxLEgZGEgZGFoaWwgb2xtYWsKICAgICAgICAvLyDDvHplcmUgYnUgZm9ua3NpeW9uIHnDvHLDvHRtZXNpbmRla2kgdMO8bQogICAgICAgIC8vIGRlxJ9pxZ9pa2xpa2xlcmkgZ2VyaSBhbGFjYWt0xLFyKS4KICAgICAgICBpZiAobXNnLnZhbHVlIDw9IGhpZ2hlc3RCaWQpCiAgICAgICAgICAgIHJldmVydCBCaWROb3RIaWdoRW5vdWdoKGhpZ2hlc3RCaWQpOwoKICAgICAgICBpZiAoaGlnaGVzdEJpZCAhPSAwKSB7CiAgICAgICAgICAgIC8vIEJhc2l0IGJpciDFn2VraWxkZSBoaWdoZXN0QmlkZGVyLnNlbmQoaGlnaGVzdEJpZCknaQogICAgICAgICAgICAvLyBrdWxsYW5hcmFrIHBhcmEgZ8O2bmRlcm1layBiaXIgZ8O8dmVubGlrIHJpc2tpIG9sdcWfdHVydXlvcgogICAgICAgICAgICAvLyDDp8O8bmvDvCBnw7x2ZW5pbG1leiBiaXIga29udHJhdMSxIChpw6dpbmRlIGZhbGxiYWNrIGZvbmtzaXlvbnUKICAgICAgICAgICAgLy8gacOnZXJlbikgw6dhbMSxxZ90xLFyYWJpbGlyLiBIZXIgemFtYW4ga2F0xLFsxLFtY8SxbGFyxLFuIHBhcmFsYXLEsW7EsQogICAgICAgICAgICAvLyBrZW5kaWxlcmluaW4gw6dla21lbGVyaSBkYWhhIGfDvHZlbmlsaXJkaXIuCiAgICAgICAgICAgIHBlbmRpbmdSZXR1cm5zW2hpZ2hlc3RCaWRkZXJdICs9IGhpZ2hlc3RCaWQ7CiAgICAgICAgfQogICAgICAgIGhpZ2hlc3RCaWRkZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIGhpZ2hlc3RCaWQgPSBtc2cudmFsdWU7CiAgICAgICAgZW1pdCBIaWdoZXN0QmlkSW5jcmVhc2VkKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgLy8vIEdlw6dpbG1pxZ8gYmlyIHRla2xpZmluIHBhcmFzxLFuxLEgZ2VyaSDDp2VrLgogICAgZnVuY3Rpb24gd2l0aGRyYXcoKSBleHRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBhbW91bnQgPSBwZW5kaW5nUmV0dXJuc1ttc2cuc2VuZGVyXTsKICAgICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgICAgICAvLyBCdSBkZcSfZXJpIHPEsWbEsXJhIGXFn2l0bGVtZWsgw7ZuZW1saSDDp8O8bmvDvCBhbMSxY8SxIGJ1IGZvbmtzaXlvbnUKICAgICAgICAgICAgLy8gYHNlbmRgIHRhbWFtbGFubWFkYW4gdGVrcmFyIMOnYcSfxLFyxLFyc2EgKHJlZW50cmFuY3kpIGFsbWFzxLEgZ2VyZWtlbmRlbgogICAgICAgICAgICAvLyBkYWhhIGZhemxhIHBhcmEgw6dla2ViaWxpci4KICAgICAgICAgICAgcGVuZGluZ1JldHVybnNbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgICAgICAgLy8gbXNnLnNlbmRlciBgYWRkcmVzcyBwYXlhYmxlYCB0w7xyw7xuZGUgZGXEn2lsIHZlIGBzZW5kKClgCiAgICAgICAgICAgIC8vIGZvbmtzaXlvbnVuZGEgw6dhxJ9yxLFsYWJpbG1lc2kgYHBheWFibGUobXNnLnNlbmRlcilgIGlsZQogICAgICAgICAgICAvLyBgYWRkcmVzcyBwYXlhYmxlYCBhIGTDtm7DvMWfdMO8csO8bG1lc2kgZ2VyZWtpeW9yLgogICAgICAgICAgICBpZiAoIXBheWFibGUobXNnLnNlbmRlcikuc2VuZChhbW91bnQpKSB7CiAgICAgICAgICAgICAgICAvLyBObyBuZWVkIHRvIGNhbGwgdGhyb3cgaGVyZSwganVzdCByZXNldCB0aGUgYW1vdW50IG93aW5nCiAgICAgICAgICAgICAgICBwZW5kaW5nUmV0dXJuc1ttc2cuc2VuZGVyXSA9IGFtb3VudDsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gxLBoYWxleWkgYml0aXIgdmUgZW4gecO8a3NlayB0ZWtsaWZpCiAgICAvLy8gaGFrIHNhaGliaW5lIGfDtm5kZXIuCiAgICBmdW5jdGlvbiBhdWN0aW9uRW5kKCkgZXh0ZXJuYWwgewogICAgICAgIC8vIERpxJ9lciBrb250cmF0bGFyIGlsZSBldGtpbGXFn2ltZSBnaXJlbiAoZm9ua3NpeW9uIMOnYcSfxLFyYW4geWEgZGEKICAgICAgICAvLyBFdGhlciBnw7ZuZGVyZW4pIGZvbmtzaXlvbmxhcsSxIMO8w6cgcGFyw6dhZGEgxZ9la2lsbGRlbmlybWVrIGfDvHplbCBiaXIgecO2bnRlbS4KICAgICAgICAvLyDFnnUgcGFyw6dhbGFyCiAgICAgICAgLy8gMS4ga2/Fn3VsIGtvbnRyb2xsZXJpCiAgICAgICAgLy8gMi4gZXlsZW0gZ2Vyw6dla2xlxZ90aXJlbmxlciAoa2/Fn3VsbGFyxLEgZGXEn2nFn3RpcmViaWxpcmxlcikKICAgICAgICAvLyAzLiBiYcWfa2Ega29udHJhdGxhcmxhciBldGtpbGXFn2ltZSBnaXJlbmxlcgogICAgICAgIC8vIEXDvGVyIGJ1IGZhemxhciBrYXLEscWfxLFyc2EsIGRpxJ9lciBrb250cmF0IGJ1IGtvbnRyYXTEsSDDp2HEn8SxcsSxcAogICAgICAgIC8vIGR1cnVtbGFyxLEgZGXEn2nFn3RpcmViaWxpciB5YSBkYSBvbGF5bGFyxLFuIChldGhlciDDtmRlbWVzaSBnaWJpKQogICAgICAgIC8vIGJpcmthw6cga2VyZSBnZXLDp2VrbGXFn21lc2luZSBzZWJlcCBvbGFiaWxpci4KICAgICAgICAvLyBFxJ9lciBpw6dlcmlkZW4gw6dhxJ/EsXLEsWxhbiBmb25rc2l5b25sYXIgYmHFn2thIGtvbnRyYXRsYXJsYSBldGtpbGXFn2ltZQogICAgICAgIC8vIGdpcml5b3JzYSBvIGZvbmtzaXlvbmxhciBkYSBiYcWfa2EgZm9ua3NpeW9ubGFybGEgZXRraWxlxZ9lbmxlciBvbGFyYWsKICAgICAgICAvLyBkZcSfZXJsZW5kaXJpbG1lbGkKCiAgICAgICAgLy8gMS4gxZ5hcnRsYXIKICAgICAgICBpZiAoYmxvY2sudGltZXN0YW1wIDwgYXVjdGlvbkVuZFRpbWUpCiAgICAgICAgICAgIHJldmVydCBBdWN0aW9uTm90WWV0RW5kZWQoKTsKICAgICAgICBpZiAoZW5kZWQpCiAgICAgICAgICAgIHJldmVydCBBdWN0aW9uRW5kQWxyZWFkeUNhbGxlZCgpOwoKICAgICAgICAvLyAyLiBFdGtpbGVyCiAgICAgICAgZW5kZWQgPSB0cnVlOwogICAgICAgIGVtaXQgQXVjdGlvbkVuZGVkKGhpZ2hlc3RCaWRkZXIsIGhpZ2hlc3RCaWQpOwoKICAgICAgICAvLyAzLiBFdGtpbGXFn2ltCiAgICAgICAgYmVuZWZpY2lhcnkudHJhbnNmZXIoaGlnaGVzdEJpZCk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">SimpleAuction</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// İhalenin parametreleri. Süreler unix zaman damgası</span>
<span class="w">    </span><span class="c1">// (1970-01-01&#39;den itibaren saniyeler) ya da saniye</span>
<span class="w">    </span><span class="c1">// cinsinden ne kadar süreceği.</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>beneficiary<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">auctionEndTime</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// İhalenin şu an ki durumu</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">highestBidder</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">highestBid</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Önceki tekliflerden para çekmeye izin verilenler</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>pendingReturns<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// En son `true`ya çevir, herhangi bir değişiklik yapılmasını engeller</span>
<span class="w">    </span><span class="c1">// varsayılan olarak `false` tanımlanır.</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nv">ended</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Değişikliklerde yayınlanacak Event&#39;ler</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">HighestBidIncreased</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">bidder</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">AuctionEnded</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">winner</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Başarısızları açıklayan hatalar</span>

<span class="w">    </span><span class="c1">// Üçlü eğik çizgiler natspec yorumları olarak</span>
<span class="w">    </span><span class="c1">// adlandırılır. Kullanıcıya bir işlemi onaylayacağı</span>
<span class="w">    </span><span class="c1">// zaman ya da bir hatada gösterilir.</span>

<span class="w">    </span><span class="c1">/// İhale bitti.</span>
<span class="w">    </span>error<span class="w"> </span>AuctionAlreadyEnded<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// Eşit ya da daha yüksek bir teklif var.</span>
<span class="w">    </span>error<span class="w"> </span>BidNotHighEnough<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">highestBid</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// Teklif henüz bitmedi.</span>
<span class="w">    </span>error<span class="w"> </span>AuctionNotYetEnded<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// auctionEnd fonksiyonu zaten çağrıldı.</span>
<span class="w">    </span>error<span class="w"> </span>AuctionEndAlreadyCalled<span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Hak sahibi adına `beneficiaryAddress`</span>
<span class="w">    </span><span class="c1">/// `biddingTime` daki süre ile bir ihale başlatır.</span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">biddingTime</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>beneficiaryAddress<span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>beneficiary<span class="w"> </span><span class="o">=</span><span class="w"> </span>beneficiaryAddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span>auctionEndTime<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>biddingTime<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// İşlemle birlikte teklifteki para da</span>
<span class="w">    </span><span class="c1">/// gönderilir. Ödeme sadece teklif kazanmazsa</span>
<span class="w">    </span><span class="c1">/// iade edilir.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">bid</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Herhangi bir argümana gerek yok,</span>
<span class="w">        </span><span class="c1">// bütün bilgi zaten işlemin parçası.</span>
<span class="w">        </span><span class="c1">// payable anahtar kelimesi fonksiyonun</span>
<span class="w">        </span><span class="c1">// Ether alabilmesi için zorunlu.</span>

<span class="w">        </span><span class="c1">// teklif süreci bittiyse çağrıyı</span>
<span class="w">        </span><span class="c1">// geri çevir.</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>auctionEndTime<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>AuctionAlreadyEnded<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Teklif daha yüksek değilse,</span>
<span class="w">        </span><span class="c1">// parayı geri gönderin (revert ifadesi</span>
<span class="w">        </span><span class="c1">// parayı almış olması da dahil olmak</span>
<span class="w">        </span><span class="c1">// üzere bu fonksiyon yürütmesindeki tüm</span>
<span class="w">        </span><span class="c1">// değişiklikleri geri alacaktır).</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span>highestBid<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>BidNotHighEnough<span class="p">(</span>highestBid<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>highestBid<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Basit bir şekilde highestBidder.send(highestBid)&#39;i</span>
<span class="w">            </span><span class="c1">// kullanarak para göndermek bir güvenlik riski oluşturuyor</span>
<span class="w">            </span><span class="c1">// çünkü güvenilmez bir kontratı (içinde fallback fonksiyonu</span>
<span class="w">            </span><span class="c1">// içeren) çalıştırabilir. Her zaman katılımcıların paralarını</span>
<span class="w">            </span><span class="c1">// kendilerinin çekmeleri daha güvenilirdir.</span>
<span class="w">            </span>pendingReturns<span class="p">[</span>highestBidder<span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>highestBid<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span>highestBidder<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>highestBid<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>HighestBidIncreased<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span><span class="k">msg.value</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Geçilmiş bir teklifin parasını geri çek.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pendingReturns<span class="p">[</span><span class="k">msg.sender</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>amount<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Bu değeri sıfıra eşitlemek önemli çünkü alıcı bu fonksiyonu</span>
<span class="w">            </span><span class="c1">// `send` tamamlanmadan tekrar çağırırsa (reentrancy) alması gerekenden</span>
<span class="w">            </span><span class="c1">// daha fazla para çekebilir.</span>
<span class="w">            </span>pendingReturns<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="c1">// msg.sender `address payable` türünde değil ve `send()`</span>
<span class="w">            </span><span class="c1">// fonksiyonunda çağrılabilmesi `payable(msg.sender)` ile</span>
<span class="w">            </span><span class="c1">// `address payable` a dönüştürülmesi gerekiyor.</span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">).</span>send<span class="p">(</span>amount<span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="c1">// No need to call throw here, just reset the amount owing</span>
<span class="w">                </span>pendingReturns<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// İhaleyi bitir ve en yüksek teklifi</span>
<span class="w">    </span><span class="c1">/// hak sahibine gönder.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">auctionEnd</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Diğer kontratlar ile etkileşime giren (fonksiyon çağıran ya da</span>
<span class="w">        </span><span class="c1">// Ether gönderen) fonksiyonları üç parçada şekilldenirmek güzel bir yöntem.</span>
<span class="w">        </span><span class="c1">// Şu parçalar</span>
<span class="w">        </span><span class="c1">// 1. koşul kontrolleri</span>
<span class="w">        </span><span class="c1">// 2. eylem gerçekleştirenler (koşulları değiştirebilirler)</span>
<span class="w">        </span><span class="c1">// 3. başka kontratlarlar etkileşime girenler</span>
<span class="w">        </span><span class="c1">// Eüer bu fazlar karışırsa, diğer kontrat bu kontratı çağırıp</span>
<span class="w">        </span><span class="c1">// durumları değiştirebilir ya da olayların (ether ödemesi gibi)</span>
<span class="w">        </span><span class="c1">// birkaç kere gerçekleşmesine sebep olabilir.</span>
<span class="w">        </span><span class="c1">// Eğer içeriden çağırılan fonksiyonlar başka kontratlarla etkileşime</span>
<span class="w">        </span><span class="c1">// giriyorsa o fonksiyonlar da başka fonksiyonlarla etkileşenler olarak</span>
<span class="w">        </span><span class="c1">// değerlendirilmeli</span>

<span class="w">        </span><span class="c1">// 1. Şartlar</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>auctionEndTime<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>AuctionNotYetEnded<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>ended<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>AuctionEndAlreadyCalled<span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="c1">// 2. Etkiler</span>
<span class="w">        </span>ended<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>AuctionEnded<span class="p">(</span>highestBidder<span class="p">,</span><span class="w"> </span>highestBid<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// 3. Etkileşim</span>
<span class="w">        </span>beneficiary<span class="p">.</span>transfer<span class="p">(</span>highestBid<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>Gizli İhale<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h3>
<p>Aşağıda yukarıdaki açık ihalenin kapalı ihaleye dönüştürülmüş halini bulabilirsiniz.
Gizli ihalenin avantajı ihale sürecinin sonunda doğru bir zaman baskısı oluşturmaması.
Saydam bir işlem platformunda gizli ihale oluşturmak çelişkili olsa da kriptografi
burada yardımımıza koşuyor.</p>
<p><strong>Teklif süreci</strong> boyunca, teklif veren kişi aslında gerçekten teklif yapmıyor, sadece
hashlenmiş bir halini gönderiyor. Şu an hash değerleri eşit olan iki değer (yeterince uzun)
bulmak pratik olarak imkansız olduğundan, teklif veren kişi bu şekilde teklif oluşturmuş olur.
Teklif süreci bittikten sonra teklif veren kişiler tekliflerini açıklamalı, girdikleri şifrelenmemiş
değerin hashlenmiş hali ile önceden girdikleri hash ile aynı olmalıdır.</p>
<p>Başka bir zorluk da <strong>gizlilik ve bağlayıcılığı</strong> aynı anda sağlamak. Teklif veren kişinin
kazandıktan sonra teklifinden vazgeçmemesinin tek yolu teklif ile birlikte parayı
da yollaması ancak transferler Ethereum’da gizlenemediğinden herhangi bir kişi miktarı görebilir.</p>
<p>Aşağıdaki kotnrat bu sorunu teklif ile birlikte herhangi bir miktar paranın
birlikte gönderilmesiyle çözüyor. Miktar ile teklifin eşitliği sadece açıklama
fazında ortaya anlaşılabildiği için bazı teklifleri <strong>geçersiz</strong> olabilir, ve teklif
veren kişiler bunu kasıtlı olarak kullanabilir (hatta bu durum daha fazla gizlilik sağlıyor)
Teklif veren kişiler kasıtlı olarak bir kaç yüksek ve düşük geçersiz teklifler oluşturarak
kafa karıştırabilirler.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKY29udHJhY3QgQmxpbmRBdWN0aW9uIHsKICAgIHN0cnVjdCBCaWQgewogICAgICAgIGJ5dGVzMzIgYmxpbmRlZEJpZDsKICAgICAgICB1aW50IGRlcG9zaXQ7CiAgICB9CgogICAgYWRkcmVzcyBwYXlhYmxlIHB1YmxpYyBiZW5lZmljaWFyeTsKICAgIHVpbnQgcHVibGljIGJpZGRpbmdFbmQ7CiAgICB1aW50IHB1YmxpYyByZXZlYWxFbmQ7CiAgICBib29sIHB1YmxpYyBlbmRlZDsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gQmlkW10pIHB1YmxpYyBiaWRzOwoKICAgIGFkZHJlc3MgcHVibGljIGhpZ2hlc3RCaWRkZXI7CiAgICB1aW50IHB1YmxpYyBoaWdoZXN0QmlkOwoKICAgIC8vIMOWbmNla2kgdGVrbGlmbGVyZGVuIHBhcmEgw6dla21leWUgaXppbiB2ZXJpbGVubGVyCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcGVuZGluZ1JldHVybnM7CgogICAgZXZlbnQgQXVjdGlvbkVuZGVkKGFkZHJlc3Mgd2lubmVyLCB1aW50IGhpZ2hlc3RCaWQpOwoKICAgIC8vIEJhxZ9hcsSxc8SxemxhcsSxIGHDp8Sxa2xheWFuIGhhdGFsYXIKCiAgICAvLy8gRm9ua3NpeW9uIGVya2VuIMOnYcSfxLFyxLFsZMSxLgogICAgLy8vIGB0aW1lYCBkZSB0ZWtyYXIgZGVuZXlpbi4KICAgIGVycm9yIFRvb0Vhcmx5KHVpbnQgdGltZSk7CiAgICAvLy8gRm9ua3N5aW9uIGdlw6cgw6dhxJ/EsXLEsWxkxLEuCiAgICAvLy8gYHRpbWVgIGRhbiBzb25yYSDDp2HEn8SxcsSxbGFtYXouCiAgICBlcnJvciBUb29MYXRlKHVpbnQgdGltZSk7CiAgICAvLy8gYXVjdGlvbkVuZCBmb25rc3lpb251IHphdGVuIMOnYcSfxLFyxLFsZMSxLgogICAgZXJyb3IgQXVjdGlvbkVuZEFscmVhZHlDYWxsZWQoKTsKCiAgICAvLyBNb2RpZmllcmxhciBmb25rc2l5b24gZ2lyZGlsZXJpbmkga29udHJvbCBldG1lbmluCiAgICAvLyBrb2xheSBiaXIgecO2bnRlbWlkaXIuIGBvbmx5QmVmb3JlYCBtb2RpZmllcsSxIGHFn2HEn8SxZGFraQogICAgLy8gYGJpZGAgZSB1eWd1bGFuZMSxOgogICAgLy8gWWVuaSBmb25rc3lpb251biBnw7Z2ZGUga8Sxc23EsSBtb2RpZmllcsSxbiBnw7Z2ZGUga8Sxc23EsSBvbHV5b3IuCiAgICAvLyBTYWRlY2UgYF9gIGVza2kgZm9ua3NpeW9udW4gZ8O2dmRlc2l5bGUgZGXEn2nFn2l5b3IuLgogICAgbW9kaWZpZXIgb25seUJlZm9yZSh1aW50IHRpbWUpIHsKICAgICAgICBpZiAoYmxvY2sudGltZXN0YW1wID49IHRpbWUpIHJldmVydCBUb29MYXRlKHRpbWUpOwogICAgICAgIF87CiAgICB9CiAgICBtb2RpZmllciBvbmx5QWZ0ZXIodWludCB0aW1lKSB7CiAgICAgICAgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSB0aW1lKSByZXZlcnQgVG9vRWFybHkodGltZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBjb25zdHJ1Y3RvcigKICAgICAgICB1aW50IGJpZGRpbmdUaW1lLAogICAgICAgIHVpbnQgcmV2ZWFsVGltZSwKICAgICAgICBhZGRyZXNzIHBheWFibGUgYmVuZWZpY2lhcnlBZGRyZXNzCiAgICApIHsKICAgICAgICBiZW5lZmljaWFyeSA9IGJlbmVmaWNpYXJ5QWRkcmVzczsKICAgICAgICBiaWRkaW5nRW5kID0gYmxvY2sudGltZXN0YW1wICsgYmlkZGluZ1RpbWU7CiAgICAgICAgcmV2ZWFsRW5kID0gYmlkZGluZ0VuZCArIHJldmVhbFRpbWU7CiAgICB9CiAgICAvLy8gYGJsaW5kZWRCaWRgID0ga2VjY2FrMjU2KGFiaS5lbmNvZGVQYWNrZWQodmFsdWUsIGZha2UsIHNlY3JldCkpCiAgICAvLy8gaWxlIGdpemxpIGJpciB0ZWtsaWYgdmVyLiBHw7ZuZGVyaWxlbiBldGhlciBzYWRlY2UgdGVrbGlmIGRvxJ9ydQogICAgLy8vIGJpciDFn2VraWxkZSBhw6fEsWtsYW5kxLF5c2EgZ2VyaSBhbMSxbmFiaWxpci4gVGVrbGlmIGXEn2VyICJ2YWx1ZSJkYWtpCiAgICAvLy8gZGXEn2VyIGlsZSBlbiBheiBnw7ZuZGVyaWxlbiBFdGhlciBrYWRhciB5YSBkYSAiZmFrZSIgZGXEn2VyaSBgZmFsc2VgCiAgICAvLy8gaXNlIGdlw6dlcmxpZGlyLiAgQmlyIG1pa3RhciBFdGhlciB5YXTEsXLEsWxtYXPEsSAgZ2VyZWtzZW5lZGUKICAgIC8vLyAiZmFrZSIgZGXEn2VyaW5pIGB0cnVlYCB5YXBtYWsgdmUgInZhbHVlIiBkZcSfZXJpbmRlbgogICAgLy8vIGZhcmtsxLEgbWlrdGFyZGEgRXRoZXIgZ8O2bmRlcm1layBnZXLDp2VrIHRla2xpZmkgZ2l6bGVtZW5pbiB5w7ZudGVtbGVyaWRpci4KICAgIC8vLyBBeW7EsSBhZHJlcyBiaXJkZW4gZmF6bGEga2V6IHBhcmEgeWF0xLFyYWJpbGlyLgogICAgZnVuY3Rpb24gYmlkKGJ5dGVzMzIgYmxpbmRlZEJpZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWFibGUKICAgICAgICBvbmx5QmVmb3JlKGJpZGRpbmdFbmQpCiAgICB7CiAgICAgICAgYmlkc1ttc2cuc2VuZGVyXS5wdXNoKEJpZCh7CiAgICAgICAgICAgIGJsaW5kZWRCaWQ6IGJsaW5kZWRCaWQsCiAgICAgICAgICAgIGRlcG9zaXQ6IG1zZy52YWx1ZQogICAgICAgIH0pKTsKICAgIH0KCiAgICAvLy8gR2l6bGkgdGVrbGlmaW5pIGHDp8Sxa2xhLiBUw7xtIHRla2xpZmxlciBhcmFzxLFuZGEgZW4gecO8a3NlayBvbGFuIGhhcmnDpwogICAgLy8vIGRvxJ9ydSDFn2VraWxkZSBhw6fEsWtsYW5txLHFnyB0w7xtIHRla2xpZmxlcmluIHBhcmFzxLFuxLEgaWFkZSBhbGFiaWxpcnNpbi4KICAgIGZ1bmN0aW9uIHJldmVhbCgKICAgICAgICB1aW50W10gY2FsbGRhdGEgdmFsdWVzLAogICAgICAgIGJvb2xbXSBjYWxsZGF0YSBmYWtlcywKICAgICAgICBieXRlczMyW10gY2FsbGRhdGEgc2VjcmV0cwogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUFmdGVyKGJpZGRpbmdFbmQpCiAgICAgICAgb25seUJlZm9yZShyZXZlYWxFbmQpCiAgICB7CiAgICAgICAgdWludCBsZW5ndGggPSBiaWRzW21zZy5zZW5kZXJdLmxlbmd0aDsKICAgICAgICByZXF1aXJlKHZhbHVlcy5sZW5ndGggPT0gbGVuZ3RoKTsKICAgICAgICByZXF1aXJlKGZha2VzLmxlbmd0aCA9PSBsZW5ndGgpOwogICAgICAgIHJlcXVpcmUoc2VjcmV0cy5sZW5ndGggPT0gbGVuZ3RoKTsKCiAgICAgICAgdWludCByZWZ1bmQ7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgQmlkIHN0b3JhZ2UgYmlkVG9DaGVjayA9IGJpZHNbbXNnLnNlbmRlcl1baV07CiAgICAgICAgICAgICh1aW50IHZhbHVlLCBib29sIGZha2UsIGJ5dGVzMzIgc2VjcmV0KSA9CiAgICAgICAgICAgICAgICAgICAgKHZhbHVlc1tpXSwgZmFrZXNbaV0sIHNlY3JldHNbaV0pOwogICAgICAgICAgICBpZiAoYmlkVG9DaGVjay5ibGluZGVkQmlkICE9IGtlY2NhazI1NihhYmkuZW5jb2RlUGFja2VkKHZhbHVlLCBmYWtlLCBzZWNyZXQpKSkgewogICAgICAgICAgICAgICAgLy8gVGVrbGlmIGHDp8Sxa2xhbm1hZMSxCiAgICAgICAgICAgICAgICAvLyBZYXTEsXLEsWxhbiBwYXJhecSxIGlhZGUgZXRtZQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVmdW5kICs9IGJpZFRvQ2hlY2suZGVwb3NpdDsKICAgICAgICAgICAgaWYgKCFmYWtlICYmIGJpZFRvQ2hlY2suZGVwb3NpdCA+PSB2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKHBsYWNlQmlkKG1zZy5zZW5kZXIsIHZhbHVlKSkKICAgICAgICAgICAgICAgICAgICByZWZ1bmQgLT0gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gR8O2bmRlcmljaW5pbiBnw7ZuZGVyZGnEn2kgcGFyYXnEsSB0ZWtyYXIgZ2VyaSBhbG1hc8SxbsSxCiAgICAgICAgICAgIC8vIGlta2Fuc8SxeiBoYWxlIGdldGlyLgogICAgICAgICAgICBiaWRUb0NoZWNrLmJsaW5kZWRCaWQgPSBieXRlczMyKDApOwogICAgICAgIH0KICAgICAgICBwYXlhYmxlKG1zZy5zZW5kZXIpLnRyYW5zZmVyKHJlZnVuZCk7CiAgICB9CgogICAgLy8vIEZhemxhZGFuIHBhcmEgeWF0xLFyxLFsbcSxxZ8gYmlyIHRla2xpZmkgZ2VyaSDDp2VrLgogICAgZnVuY3Rpb24gd2l0aGRyYXcoKSBleHRlcm5hbCB7CiAgICAgICAgdWludCBhbW91bnQgPSBwZW5kaW5nUmV0dXJuc1ttc2cuc2VuZGVyXTsKICAgICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgICAgICAvLyBCdSBkZcSfZXJpIHPEsWbEsXJhIGXFn2l0bGVtZWsgw7ZuZW1saSDDp8O8bmvDvCBhbMSxY8SxIGJ1IGZvbmtzaXlvbnUKICAgICAgICAgICAgLy8gYHNlbmRgIHRhbWFtbGFubWFkYW4gdGVrcmFyIMOnYcSfxLFyxLFyc2EgKHJlZW50cmFuY3kpIGFsbWFzxLEgZ2VyZWtlbmRlbgogICAgICAgICAgICAvLyBkYWhhIGZhemxhIHBhcmEgw6dla2ViaWxpci4gKHl1a2FyxLFkYWtpIMWfYXJ0bGFyIC0+IGV0a2lsZXIgLT4gZXRraWxlxZ9pbWxlcgogICAgICAgICAgICAvLyBoYWtrxLFuZGFraSBiaWxnaWxlbmRpcm1leWUgYmFrYWJpbGlyc2luaXopCiAgICAgICAgICAgIHBlbmRpbmdSZXR1cm5zW21zZy5zZW5kZXJdID0gMDsKCiAgICAgICAgICAgIHBheWFibGUobXNnLnNlbmRlcikudHJhbnNmZXIoYW1vdW50KTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIMSwaGFsZXlpIGJpdGlyIHZlIGVuIHnDvHNlayB0ZWtsaWZpCiAgICAvLy8gaGFrIHNhaGliaW5lIGfDtm5kZXIuCiAgICBmdW5jdGlvbiBhdWN0aW9uRW5kKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlBZnRlcihyZXZlYWxFbmQpCiAgICB7CiAgICAgICAgaWYgKGVuZGVkKSByZXZlcnQgQXVjdGlvbkVuZEFscmVhZHlDYWxsZWQoKTsKICAgICAgICBlbWl0IEF1Y3Rpb25FbmRlZChoaWdoZXN0QmlkZGVyLCBoaWdoZXN0QmlkKTsKICAgICAgICBlbmRlZCA9IHRydWU7CiAgICAgICAgYmVuZWZpY2lhcnkudHJhbnNmZXIoaGlnaGVzdEJpZCk7CiAgICB9CgogICAgLy8gImludGVybmFsIiAoacOnc2VsKSBiaXIgZm9ua3NpeW9uIHlhbmkgc2FkZWNlIGtvbnRyYXTEsW4KICAgIC8vIGtlbmRpc2kgKHlhIGRhIGJ1IGtvbnRyYXR0YW4gw6fEsWthbiAoZGVyaXZlIGVkaWxlbikga29udHJhdGxhcikKICAgIC8vIGJ1bnUgw6dhxJ/EsXJhYmlsaXIuCiAgICBmdW5jdGlvbiBwbGFjZUJpZChhZGRyZXNzIGJpZGRlciwgdWludCB2YWx1ZSkgaW50ZXJuYWwKICAgICAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIGlmICh2YWx1ZSA8PSBoaWdoZXN0QmlkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGhpZ2hlc3RCaWRkZXIgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICAvLyDDlm5jZWtpIGVuIHnDvGtzZWsgdGVrbGlmaW4gcGFyYXPEsW7EsSBpYWRlIGV0LgogICAgICAgICAgICBwZW5kaW5nUmV0dXJuc1toaWdoZXN0QmlkZGVyXSArPSBoaWdoZXN0QmlkOwogICAgICAgIH0KICAgICAgICBoaWdoZXN0QmlkID0gdmFsdWU7CiAgICAgICAgaGlnaGVzdEJpZGRlciA9IGJpZGRlcjsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">BlindAuction</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Bid</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">blindedBid</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">deposit</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>beneficiary<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">biddingEnd</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">revealEnd</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">public </span><span class="nv">ended</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>Bid<span class="p">[])</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>bids<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">highestBidder</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">highestBid</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Önceki tekliflerden para çekmeye izin verilenler</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>pendingReturns<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">AuctionEnded</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">winner</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">highestBid</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Başarısızları açıklayan hatalar</span>

<span class="w">    </span><span class="c1">/// Fonksiyon erken çağırıldı.</span>
<span class="w">    </span><span class="c1">/// `time` de tekrar deneyin.</span>
<span class="w">    </span>error<span class="w"> </span>TooEarly<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">time</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// Fonksyion geç çağırıldı.</span>
<span class="w">    </span><span class="c1">/// `time` dan sonra çağırılamaz.</span>
<span class="w">    </span>error<span class="w"> </span>TooLate<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">time</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// auctionEnd fonksyionu zaten çağırıldı.</span>
<span class="w">    </span>error<span class="w"> </span>AuctionEndAlreadyCalled<span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Modifierlar fonksiyon girdilerini kontrol etmenin</span>
<span class="w">    </span><span class="c1">// kolay bir yöntemidir. `onlyBefore` modifierı aşağıdaki</span>
<span class="w">    </span><span class="c1">// `bid` e uygulandı:</span>
<span class="w">    </span><span class="c1">// Yeni fonksyionun gövde kısmı modifierın gövde kısmı oluyor.</span>
<span class="w">    </span><span class="c1">// Sadece `_` eski fonksiyonun gövdesiyle değişiyor..</span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyBefore<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>time<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>TooLate<span class="p">(</span>time<span class="p">);</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyAfter<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span>time<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>TooEarly<span class="p">(</span>time<span class="p">);</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">biddingTime</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">revealTime</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>beneficiaryAddress<span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>beneficiary<span class="w"> </span><span class="o">=</span><span class="w"> </span>beneficiaryAddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span>biddingEnd<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>biddingTime<span class="p">;</span><span class="w"></span>
<span class="w">        </span>revealEnd<span class="w"> </span><span class="o">=</span><span class="w"> </span>biddingEnd<span class="w"> </span><span class="o">+</span><span class="w"> </span>revealTime<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// `blindedBid` = keccak256(abi.encodePacked(value, fake, secret))</span>
<span class="w">    </span><span class="c1">/// ile gizli bir teklif ver. Gönderilen ether sadece teklif doğru</span>
<span class="w">    </span><span class="c1">/// bir şekilde açıklandıysa geri alınabilir. Teklif eğer &quot;value&quot;daki</span>
<span class="w">    </span><span class="c1">/// değer ile en az gönderilen Ether kadar ya da &quot;fake&quot; değeri `false`</span>
<span class="w">    </span><span class="c1">/// ise geçerlidir.  Bir miktar Ether yatırılması  gereksenede</span>
<span class="w">    </span><span class="c1">/// &quot;fake&quot; değerini `true` yapmak ve &quot;value&quot; değerinden</span>
<span class="w">    </span><span class="c1">/// farklı miktarda Ether göndermek gerçek teklifi gizlemenin yöntemleridir.</span>
<span class="w">    </span><span class="c1">/// Aynı adres birden fazla kez para yatırabilir.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">bid</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">blindedBid</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span><span class="kt">payable</span><span class="w"></span>
<span class="w">        </span>onlyBefore<span class="p">(</span>biddingEnd<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>bids<span class="p">[</span><span class="k">msg.sender</span><span class="p">].</span>push<span class="p">(</span>Bid<span class="p">({</span><span class="w"></span>
<span class="w">            </span>blindedBid<span class="p">:</span><span class="w"> </span>blindedBid<span class="p">,</span><span class="w"></span>
<span class="w">            </span>deposit<span class="p">:</span><span class="w"> </span><span class="k">msg.value</span><span class="w"></span>
<span class="w">        </span><span class="p">}));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Gizli teklifini açıkla. Tüm teklifler arasında en yüksek olan hariç</span>
<span class="w">    </span><span class="c1">/// doğru şekilde açıklanmış tüm tekliflerin parasını iade alabilirsin.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">reveal</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>calldata<span class="w"> </span>values<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bool</span><span class="p">[]</span><span class="w"> </span>calldata<span class="w"> </span>fakes<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="p">[]</span><span class="w"> </span>calldata<span class="w"> </span>secrets<span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>onlyAfter<span class="p">(</span>biddingEnd<span class="p">)</span><span class="w"></span>
<span class="w">        </span>onlyBefore<span class="p">(</span>revealEnd<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>bids<span class="p">[</span><span class="k">msg.sender</span><span class="p">].</span>length<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>values<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span>length<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>fakes<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span>length<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>secrets<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span>length<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">refund</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>Bid<span class="w"> </span>storage<span class="w"> </span>bidToCheck<span class="w"> </span><span class="o">=</span><span class="w"> </span>bids<span class="p">[</span><span class="k">msg.sender</span><span class="p">][</span>i<span class="p">];</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">fake</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">secret</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">                    </span><span class="p">(</span>values<span class="p">[</span>i<span class="p">],</span><span class="w"> </span>fakes<span class="p">[</span>i<span class="p">],</span><span class="w"> </span>secrets<span class="p">[</span>i<span class="p">]);</span><span class="w"></span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>bidToCheck<span class="p">.</span>blindedBid<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span>value<span class="p">,</span><span class="w"> </span>fake<span class="p">,</span><span class="w"> </span>secret<span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="c1">// Teklif açıklanmadı</span>
<span class="w">                </span><span class="c1">// Yatırılan parayı iade etme</span>
<span class="w">                </span><span class="kt">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span>refund<span class="w"> </span><span class="o">+=</span><span class="w"> </span>bidToCheck<span class="p">.</span>deposit<span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span>fake<span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span>bidToCheck<span class="p">.</span>deposit<span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>value<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>placeBid<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>value<span class="p">))</span><span class="w"></span>
<span class="w">                    </span>refund<span class="w"> </span><span class="o">-=</span><span class="w"> </span>value<span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Göndericinin gönderdiği parayı tekrar geri almasını</span>
<span class="w">            </span><span class="c1">// imkansız hale getir.</span>
<span class="w">            </span>bidToCheck<span class="p">.</span>blindedBid<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">bytes32</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">).</span>transfer<span class="p">(</span>refund<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Fazladan para yatırılmış bir teklifi geri çek.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pendingReturns<span class="p">[</span><span class="k">msg.sender</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>amount<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Bu değeri sıfıra eşitlemek önemli çünkü alıcı bu fonksiyonu</span>
<span class="w">            </span><span class="c1">// `send` tamamlanmadan tekrar çağırırsa (reentrancy) alması gerekenden</span>
<span class="w">            </span><span class="c1">// daha fazla para çekebilir. (yukarıdaki şartlar -&gt; etkiler -&gt; etkileşimler</span>
<span class="w">            </span><span class="c1">// hakkındaki bilgilendirmeye bakabilirsiniz)</span>
<span class="w">            </span>pendingReturns<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">).</span>transfer<span class="p">(</span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// İhaleyi bitir ve en yüsek teklifi</span>
<span class="w">    </span><span class="c1">/// hak sahibine gönder.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">auctionEnd</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>onlyAfter<span class="p">(</span>revealEnd<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>ended<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>AuctionEndAlreadyCalled<span class="p">();</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>AuctionEnded<span class="p">(</span>highestBidder<span class="p">,</span><span class="w"> </span>highestBid<span class="p">);</span><span class="w"></span>
<span class="w">        </span>ended<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>beneficiary<span class="p">.</span>transfer<span class="p">(</span>highestBid<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// &quot;internal&quot; (içsel) bir fonksiyon yani sadece kontratın</span>
<span class="w">    </span><span class="c1">// kendisi (ya da bu kontrattan çıkan (derive edilen) kontratlar)</span>
<span class="w">    </span><span class="c1">// bunu çağırabilir.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">placeBid</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">bidder</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"></span>
<span class="w">            </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>value<span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span>highestBid<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>highestBidder<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Önceki en yüksek teklifin parasını iade et.</span>
<span class="w">            </span>pendingReturns<span class="p">[</span>highestBidder<span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>highestBid<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span>highestBid<span class="w"> </span><span class="o">=</span><span class="w"> </span>value<span class="p">;</span><span class="w"></span>
<span class="w">        </span>highestBidder<span class="w"> </span><span class="o">=</span><span class="w"> </span>bidder<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="guvenli-uzaktan-alisveris">
<span id="index-2"></span><h2>Güvenli Uzaktan Alışveriş<a class="headerlink" href="#guvenli-uzaktan-alisveris" title="Permalink to this heading"></a></h2>
<p>Uzaktan bir mal satın almak birden fazla tarafın birbirine güvenmesini gerektirir.
En basit durumda bir satıcı bir de alıcı olur. Alıcı ürünü satıcıdan almak ister, satıcı da
karılığında parayı (ya da eş değeri bir şeyi) almak. Burada problemli kısım kargolama: Kesin olarak
malın alıcıya ulaştığından emin olmanın yolu yok.</p>
<p>Bu problemmi çözmenin birden fazla yolu var ama hepsinin bir şekilde bir eksiği oluyor.
Aşağıdaki örnekte, iki taraf da kontrata malın değerinin iki katını yatırırlar. Yatırma
gerçekleştiği anda alıcı onaylayana kadar iki tafaında parası içeride kitli kalır. Alıcı
satın almayı onayladığında malın değeri (yatırdığının yarısı) karşı tarafa geçer ve satıcı
malın üç katını (yatırdığı iki kat ve alıcının yatırdığı malın değeri) geri çeker. Bu sistemin
arkaplanındaki fikir iki tarafında problemi çözmeleri için gönüllü olmaları yoksa ikisinin parası
da içeride sonsuza kadar kitli kalacak</p>
<p>Bu kontrat tabi ki bu problemi çözmüyor ama makine benzeri  yapıları sözleşmede nasıl kullanabileceğinize
dair genel bir bakış sağlıyor.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKY29udHJhY3QgUHVyY2hhc2UgewogICAgdWludCBwdWJsaWMgdmFsdWU7CiAgICBhZGRyZXNzIHBheWFibGUgcHVibGljIHNlbGxlcjsKICAgIGFkZHJlc3MgcGF5YWJsZSBwdWJsaWMgYnV5ZXI7CgogICAgZW51bSBTdGF0ZSB7IENyZWF0ZWQsIExvY2tlZCwgUmVsZWFzZSwgSW5hY3RpdmUgfQogICAgLy8gc3RhdGUgZGXEn2nFn2tlbmkgdmFyc2F5xLFsYW4gb2xhcmFrIGlsayDDvHllZGlyLCAgYFN0YXRlLmNyZWF0ZWRgCiAgICBTdGF0ZSBwdWJsaWMgc3RhdGU7CgogICAgbW9kaWZpZXIgY29uZGl0aW9uKGJvb2wgY29uZGl0aW9uXykgewogICAgICAgIHJlcXVpcmUoY29uZGl0aW9uXyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQnUgZm9ua3NpeW9udSBzYWRlY2UgYWzEsWPEsSDDp2HEn8SxcmFiaWxpcgogICAgZXJyb3IgT25seUJ1eWVyKCk7CiAgICAvLy8gQlUgZm9ua3N5aW9udSBzYWRlY2Ugc2F0xLFjxLEgw6dhxJ/EsXJhYmlsaXIuCiAgICBlcnJvciBPbmx5U2VsbGVyKCk7CiAgICAvLy8gQnUgZm9ua3NpeW9uIMWfdSBhbiDDp2HEn8SxcsSxbGFtYXouCiAgICBlcnJvciBJbnZhbGlkU3RhdGUoKTsKICAgIC8vLyBHaXJpbGVuIGRlxJ9lciDDp2lmdCBvbG1hbMSxLgogICAgZXJyb3IgVmFsdWVOb3RFdmVuKCk7CgogICAgbW9kaWZpZXIgb25seUJ1eWVyKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGJ1eWVyKQogICAgICAgICAgICByZXZlcnQgT25seUJ1eWVyKCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5U2VsbGVyKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IHNlbGxlcikKICAgICAgICAgICAgcmV2ZXJ0IE9ubHlTZWxsZXIoKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGluU3RhdGUoU3RhdGUgc3RhdGVfKSB7CiAgICAgICAgaWYgKHN0YXRlICE9IHN0YXRlXykKICAgICAgICAgICAgcmV2ZXJ0IEludmFsaWRTdGF0ZSgpOwogICAgICAgIF87CiAgICB9CgogICAgZXZlbnQgQWJvcnRlZCgpOwogICAgZXZlbnQgUHVyY2hhc2VDb25maXJtZWQoKTsKICAgIGV2ZW50IEl0ZW1SZWNlaXZlZCgpOwogICAgZXZlbnQgU2VsbGVyUmVmdW5kZWQoKTsKCiAgICAvLyBgbXNnLnZhbHVlYCBpbiDDp2lmdCBvbGR1xJ91bmRhbiBlbWluIG9sLgogICAgLy8gRcSfZXIgdGVrIHNhecSxIGlzZSBiw7ZsbWUga8SxcnDEsWxtxLHFnyBiaXIgc29udcOnIG9sYWNhay4KICAgIC8vIMOHYXJwbWEgaWxlIHRlayBzYXnEsSBvbG1hZMSxxJ/EsW7EsSBrb250cm9sIGV0LgogICAgY29uc3RydWN0b3IoKSBwYXlhYmxlIHsKICAgICAgICBzZWxsZXIgPSBwYXlhYmxlKG1zZy5zZW5kZXIpOwogICAgICAgIHZhbHVlID0gbXNnLnZhbHVlIC8gMjsKICAgICAgICBpZiAoKDIgKiB2YWx1ZSkgIT0gbXNnLnZhbHVlKQogICAgICAgICAgICByZXZlcnQgVmFsdWVOb3RFdmVuKCk7CiAgICB9CgogICAgLy8vIFNhdMSxbiBhbG1hecSxIGlwdGFsIGV0IHZlIGV0aGVyaSBnZXJpIGFsLgogICAgLy8vIFNhZGVjZSBzYXTEsWPEsSB0YXJhZsSxbmRhbiBrb250cmF0IGtpdGxlbm1lZGVuCiAgICAvLy8gw7ZuY2Ugw6dhxJ/EsXLEsWxhYmlsaXIuCiAgICBmdW5jdGlvbiBhYm9ydCgpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5U2VsbGVyCiAgICAgICAgaW5TdGF0ZShTdGF0ZS5DcmVhdGVkKQogICAgewogICAgICAgIGVtaXQgQWJvcnRlZCgpOwogICAgICAgIHN0YXRlID0gU3RhdGUuSW5hY3RpdmU7CiAgICAgICAgLy8gQnVyYWRhIHRyYW5zZmVyJ2kgZGlyZWt0IG9sYXJhayBrdWxsYW7EsXlvcnV6LgogICAgICAgIC8vIFRla3JhciBnaXJpxZ8gKHJlZW50cmFuY3kpIHNhbGTEsXLEsWxhcsSxbmEga2FyxZ/EsSBnw7x2ZW5saQogICAgICAgIC8vIMOnw7xua8O8IGZvbmtzaXlvbmRha2kgc29uIMOnYcSfcsSxIChjYWxsKSB2ZSBkdXJ1bXUgKHN0YXRlKQogICAgICAgIC8vIHphdGVuIGRlxJ9pxZ90aXJkaWsuCiAgICAgICAgc2VsbGVyLnRyYW5zZmVyKGFkZHJlc3ModGhpcykuYmFsYW5jZSk7CiAgICB9CgogICAgLy8vIEFsxLFjxLEgb2xhcmFrIHNhdMSxbiBhbG1hecSxIG9uYXlsYS4KICAgIC8vLyDEsMWfbGVtIGAyICogdmFsdWVgIGthZGFyIGV0aGVyIGnDp2VybWVsaS4KICAgIC8vLyBFdGhlciBjb25maXJtUmVjZWl2ZWQgZm9ua3NpeW9udSDDp2HEn8SxcsSxbGFuYQogICAgLy8vIGthZGFyIGtpdGxpIGthbGFjYWsuCiAgICBmdW5jdGlvbiBjb25maXJtUHVyY2hhc2UoKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgaW5TdGF0ZShTdGF0ZS5DcmVhdGVkKQogICAgICAgIGNvbmRpdGlvbihtc2cudmFsdWUgPT0gKDIgKiB2YWx1ZSkpCiAgICAgICAgcGF5YWJsZQogICAgewogICAgICAgIGVtaXQgUHVyY2hhc2VDb25maXJtZWQoKTsKICAgICAgICBidXllciA9IHBheWFibGUobXNnLnNlbmRlcik7CiAgICAgICAgc3RhdGUgPSBTdGF0ZS5Mb2NrZWQ7CiAgICB9CgogICAgLy8vIE1hbMSxIHRlc2xpbSBhbGTEscSfxLFuxLEgb25heWxhIChhbMSxY8SxKQogICAgLy8vIEtpdGxpIGV0aGVyaSBzZXJiZXN0IGLEsXJha2FjYWsuCiAgICBmdW5jdGlvbiBjb25maXJtUmVjZWl2ZWQoKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUJ1eWVyCiAgICAgICAgaW5TdGF0ZShTdGF0ZS5Mb2NrZWQpCiAgICB7CiAgICAgICAgZW1pdCBJdGVtUmVjZWl2ZWQoKTsKICAgICAgICAvLyBEdXJ1bXUgKHN0YXRlKSDDtm5jZWRlbiBkZcSfacWfdGlybWVrIG9sZHVrw6dhIMO2bmVtbGkKICAgICAgICAvLyB5b2tzYSBhxZ9hxJ/EsWRha2kgYHNlbmRgIGkga29udHJhdGxhciBidXJhZGEgdGVrcmFyCiAgICAgICAgLy8gYnUgZm9ua3NpeW9udSDDp2HEn8SxcmFiaWxpci4gKHRla3JhciBnaXJpxZ8gc2FsZMSxcsSxc8SxIC0gcmVlbnRyYW5jeSBhdHRhY2spCiAgICAgICAgc3RhdGUgPSBTdGF0ZS5SZWxlYXNlOwoKICAgICAgICBidXllci50cmFuc2Zlcih2YWx1ZSk7CiAgICB9CgogICAgLy8vIEJ1IGZvbmtzaXlvbiBzYXTEsWPEsXlhIGlhZGUgZWRlcgogICAgLy8vIChzYXTEsWPEsW7EsW4ga2l0bGkgcGFyYXPEsW7EsSBnZXJpIMO2ZGVyKQogICAgZnVuY3Rpb24gcmVmdW5kU2VsbGVyKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlTZWxsZXIKICAgICAgICBpblN0YXRlKFN0YXRlLlJlbGVhc2UpCiAgICB7CiAgICAgICAgZW1pdCBTZWxsZXJSZWZ1bmRlZCgpOwogICAgICAgIC8vIER1cnVtdSAoc3RhdGUpIMO2bmNlZGVuIGRlxJ9pxZ90aXJtZWsgb2xkdWvDp2Egw7ZuZW1saQogICAgICAgIC8vIHlva3NhIGHFn2HEn8SxZGFraSBgc2VuZGAgaSBrb250cmF0bGFyIGJ1cmFkYSB0ZWtyYXIKICAgICAgICAvLyBidSBmb25rc2l5b251IMOnYcSfxLFyYWJpbGlyLiAodGVrcmFyIGdpcmnFnyBzYWxkxLFyxLFzxLEgLSByZWVudHJhbmN5IGF0dGFjaykKICAgICAgICBzdGF0ZSA9IFN0YXRlLkluYWN0aXZlOwoKICAgICAgICBzZWxsZXIudHJhbnNmZXIoMyAqIHZhbHVlKTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Purchase</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">value</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>seller<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>buyer<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">enum</span><span class="w"> </span><span class="nv">State</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>Created<span class="p">,</span><span class="w"> </span>Locked<span class="p">,</span><span class="w"> </span>Release<span class="p">,</span><span class="w"> </span>Inactive<span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// state değişkeni varsayılan olarak ilk üyedir,  `State.created`</span>
<span class="w">    </span>State<span class="w"> </span><span class="kt">public</span><span class="w"> </span>state<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>condition<span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">condition_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>condition_<span class="p">);</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Bu fonksiyonu sadece alıcı çağırabilir</span>
<span class="w">    </span>error<span class="w"> </span>OnlyBuyer<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// BU fonksyionu sadece satıcı çağırabilir.</span>
<span class="w">    </span>error<span class="w"> </span>OnlySeller<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// Bu fonksiyon şu an çağırılamaz.</span>
<span class="w">    </span>error<span class="w"> </span>InvalidState<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// Girilen değer çift olmalı.</span>
<span class="w">    </span>error<span class="w"> </span>ValueNotEven<span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyBuyer<span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span>buyer<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>OnlyBuyer<span class="p">();</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlySeller<span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span>seller<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>OnlySeller<span class="p">();</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>inState<span class="p">(</span>State<span class="w"> </span>state_<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>state<span class="w"> </span><span class="o">!=</span><span class="w"> </span>state_<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>InvalidState<span class="p">();</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Aborted</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">PurchaseConfirmed</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">ItemReceived</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">SellerRefunded</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">// `msg.value` in çift olduğundan emin ol.</span>
<span class="w">    </span><span class="c1">// Eğer tek sayı ise bölme kırpılmış bir sonuç olacak.</span>
<span class="w">    </span><span class="c1">// Çarpma ile tek sayı olmadığını kontrol et.</span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>seller<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>value<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">((</span><span class="m m-Decimal">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>value<span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>ValueNotEven<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Satın almayı iptal et ve etheri geri al.</span>
<span class="w">    </span><span class="c1">/// Sadece satıcı tarafından kontrat kitlenmeden</span>
<span class="w">    </span><span class="c1">/// önce çağırılabilir.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">abort</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>onlySeller<span class="w"></span>
<span class="w">        </span>inState<span class="p">(</span>State<span class="p">.</span>Created<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>Aborted<span class="p">();</span><span class="w"></span>
<span class="w">        </span>state<span class="w"> </span><span class="o">=</span><span class="w"> </span>State<span class="p">.</span>Inactive<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Burada transfer&#39;i direkt olarak kullanıyoruz.</span>
<span class="w">        </span><span class="c1">// Tekrar giriş (reentrancy) saldırılarına karşı güvenli</span>
<span class="w">        </span><span class="c1">// çünkü fonksiyondaki son çağrı (call) ve durumu (state)</span>
<span class="w">        </span><span class="c1">// zaten değiştirdik.</span>
<span class="w">        </span>seller<span class="p">.</span>transfer<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">).</span>balance<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Alıcı olarak satın almayı onayla.</span>
<span class="w">    </span><span class="c1">/// İşlem `2 * value` kadar ether içermeli.</span>
<span class="w">    </span><span class="c1">/// Ether confirmReceived fonksiyonu çağırılana</span>
<span class="w">    </span><span class="c1">/// kadar kitli kalacak.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">confirmPurchase</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>inState<span class="p">(</span>State<span class="p">.</span>Created<span class="p">)</span><span class="w"></span>
<span class="w">        </span>condition<span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="m m-Decimal">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>value<span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="kt">payable</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>PurchaseConfirmed<span class="p">();</span><span class="w"></span>
<span class="w">        </span>buyer<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>state<span class="w"> </span><span class="o">=</span><span class="w"> </span>State<span class="p">.</span>Locked<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Malı teslim aldığını onayla (alıcı)</span>
<span class="w">    </span><span class="c1">/// Kitli etheri serbest bırakacak.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">confirmReceived</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>onlyBuyer<span class="w"></span>
<span class="w">        </span>inState<span class="p">(</span>State<span class="p">.</span>Locked<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>ItemReceived<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Durumu (state) önceden değiştirmek oldukça önemli</span>
<span class="w">        </span><span class="c1">// yoksa aşağıdaki `send` i kontratlar burada tekrar</span>
<span class="w">        </span><span class="c1">// bu fonksiyonu çağırabilir. (tekrar giriş saldırısı - reentrancy attack)</span>
<span class="w">        </span>state<span class="w"> </span><span class="o">=</span><span class="w"> </span>State<span class="p">.</span>Release<span class="p">;</span><span class="w"></span>

<span class="w">        </span>buyer<span class="p">.</span>transfer<span class="p">(</span>value<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Bu fonksiyon satıcıya iade eder</span>
<span class="w">    </span><span class="c1">/// (satıcının kitli parasını geri öder)</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">refundSeller</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>onlySeller<span class="w"></span>
<span class="w">        </span>inState<span class="p">(</span>State<span class="p">.</span>Release<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>SellerRefunded<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Durumu (state) önceden değiştirmek oldukça önemli</span>
<span class="w">        </span><span class="c1">// yoksa aşağıdaki `send` i kontratlar burada tekrar</span>
<span class="w">        </span><span class="c1">// bu fonksiyonu çağırabilir. (tekrar giriş saldırısı - reentrancy attack)</span>
<span class="w">        </span>state<span class="w"> </span><span class="o">=</span><span class="w"> </span>State<span class="p">.</span>Inactive<span class="p">;</span><span class="w"></span>

<span class="w">        </span>seller<span class="p">.</span>transfer<span class="p">(</span><span class="m m-Decimal">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>value<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="mikro-odeme-kanali">
<h2>Mikro Ödeme Kanalı<a class="headerlink" href="#mikro-odeme-kanali" title="Permalink to this heading"></a></h2>
<p>Bu bölümde bir ödeme kanalı örneğinin nasıl yapılacağını öğreneceğiz.
Bu sistem belli kişiler arasındaki Ether transferini güvenli, anında
ve işlem masrafsız gerçekleştirmek için kriptografik imzaları kullanacak.
Bu örnek için, imzaların nasıl imzalandığını ve doğrulandığını anlamamız
gerekiyor.</p>
<section id="imza-olusturma-ve-dogrulama">
<h3>İmza Oluşturma ve Doğrulama<a class="headerlink" href="#imza-olusturma-ve-dogrulama" title="Permalink to this heading"></a></h3>
<p>Mesela Alice Bob’a bir miktar Ether göndermek istiyor.
Başka bir deyişle Alice gönderici Bob ise alıcı.</p>
<p>Alice’in Bob’a, çek yazmaya benzer bir şekilde, sadece
kriptografik olarak imzalanmış off-chain (zincir dışı)
bir mesaj göndermesi yeterli.</p>
<p>Alice ve Bob bu imzaları ödemeleri yetkilendirmek için kullanabilirler ve bu Ethereum üzerindeki akıllı kontratlar
ile mümkün olan bir şey. Alice Ethere göndermek için basit bir akıllı kontrat yazacak ancak bu fonksiyonu kendi
çağırmak yerine Bob’un çağırmasını isteyecek böylece Bob işlem masraflarını da ödemiş olacak.</p>
<p>Kontrat aşağıdaki şekilde ilerleyecek.</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Alice içine ödeme için gerekli Ether’i de ekleyerek <code class="docutils literal notranslate"><span class="pre">ReceiverPays</span></code> kontratını yayınlayacak.</p></li>
<li><p>Alice ödemeyi gizli anahtarı ile imzalayarak yetkilendirecek.</p></li>
<li><p>Alice kriptografik olarak imzalanmış mesajı Bob’a gönderecek. Mesajın gizli tutulmasına
(daha sonra açıklanacak) gerek yok ve mesaj herhangi bir yöntem ile gönderilebilir.</p></li>
<li><p>Bob imzalanmış mesajı akıllı kontrata girerek ödemesini alabilir, akullı kontrat mesajın
gerçekliğini doğrular ve ödemeyi serbest bırakır.</p></li>
</ol>
</div></blockquote>
<section id="imza-olusturma">
<h4>İmza oluşturma<a class="headerlink" href="#imza-olusturma" title="Permalink to this heading"></a></h4>
<p>Alice’in ödemeyi imzlamak için Ethereum ağı ile etkileşime
girmesine gerek yok, bu işlem tamamiyle çevrimdışı gerçekleştirilebilir.
Bu eğitimde, mesajları tarayıcıda  <a class="reference external" href="https://github.com/ethereum/web3.js">web3.js</a>
ve <a class="reference external" href="https://metamask.io">MetaMask</a> kullanarak ve getirdiği güvenlik kazançları
için <a class="reference external" href="https://github.com/ethereum/EIPs/pull/712">EIP-712</a>
gösterilen metot ile imzalayacağız.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">/// En başta &quot;Hash&quot;leme işleri daha kolay bir hale getirir</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">sha3</span><span class="p">(</span><span class="s2">&quot;imzalanacak mesaj&quot;</span><span class="p">);</span><span class="w"></span>
<span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">personal</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">defaultAccount</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;İmzalandı&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">web3.eth.personal.sign</span></code> mesajın uzunluğunu imzalanmış bilginin başına
ekler. İlk olarak “hash”lediğimiz için, mesaj her zaman 32 bayt uzunluğunda
olacak ve dolayısıyla bu uzunluk ön eki her zaman aynı olacak.</p>
</div>
</section>
<section id="ne-imzalanacak">
<h4>Ne İmzalanacak<a class="headerlink" href="#ne-imzalanacak" title="Permalink to this heading"></a></h4>
<p>Ödeme gerçekleştiren bir kontrat için, imzalanmış bir mesaj aşağıdakiler içermeli:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Alıcının adresi.</p></li>
<li><p>Transfer edilecek miktar.</p></li>
<li><p>Tekrarlama saldırılarına karşı önlem</p></li>
</ol>
</div></blockquote>
<p>Tekrarlama saldırısı, imzalanmış bir mesajın tekrar
yetkilendirme için kullanılmasıdır. Tekrarlama saldırılarını önlemek için
Ethereum işlemlerinden kullanan bir cüzdandan yapılan işlem sayısını, nonce,
kullanan tekniği kullanacğız. Akıllı kontrat bir <a href="#id3"><span class="problematic" id="id4">`</span></a>nonce`un bir kaç kez kullanılıp
kullanılmadığını kontrol edecek.</p>
<p>Başka bir tekrarlamma saldırısı açığı ödemeyi gönderen kişi <code class="docutils literal notranslate"><span class="pre">ReceiverPays</span></code> akıllı kontratını yayınlayıp
sonrasında yok edip sonra tekrar yayınladığında oluşur. Bunun sebebi tekrar yayınlanan kontrat önceki kontratta
kullanılan <a href="#id5"><span class="problematic" id="id6">`</span></a>nonce`ları bilemediğinden saldırgan eski mesajları tekrar kullanabilir.</p>
<p>Alice buna karşı korunmak için kontratın adresini de mesajın içerisine ekleyebilir.
Böylece sadece kontrat’ın adresini içeren mesajlar onaylanır. Bu örneği bu bölümün
sonundaki tam kontratın <code class="docutils literal notranslate"><span class="pre">claimPayment()</span></code> fonksiyonundaki ilk iki satırda görebilirsiniz.</p>
</section>
<section id="argumanlari-paketleme">
<h4>Argümanları Paketleme<a class="headerlink" href="#argumanlari-paketleme" title="Permalink to this heading"></a></h4>
<p>Şimdi imzalanmış mesajımızda nelerin olacağına karar verdiğimize göre mesajı
mesajı oluşturup, hashleyip, imzalamaya hazırız. Basit olsun diye verileri art
arda bağlayacağız. <a class="reference external" href="https://github.com/ethereumjs/ethereumjs-abi">ethereumjs-abi</a>
kütüphanesi bize <code class="docutils literal notranslate"><span class="pre">soliditySHA3</span></code> adında Solidity’deki <code class="docutils literal notranslate"><span class="pre">abi.encodePacked</span></code> ile enkode
edilmiş argümanlara <code class="docutils literal notranslate"><span class="pre">keccak256</span></code> fonksiyonu uygulanması  ile aynı işlevi gören bir
fonksiyon sağlıyor. Aşağıda <code class="docutils literal notranslate"><span class="pre">ReceiverPays</span></code> için düzgün bir imza sağlayan JavaScript
fonksiyonunu görebilirsiniz.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// recipient alıcı adres,</span><span class="w"></span>
<span class="c1">// amount, wei cinsinden, ne kadar gönderilmesi gerektiği</span><span class="w"></span>
<span class="c1">// nonce, tekrarlama saldırılarını önlemek için eşsiz bir sayı</span><span class="w"></span>
<span class="c1">// contractAddress, kontratlar arası tekrarlama saldırısını engellemek için kontrat adresi</span><span class="w"></span>
<span class="kd">function</span><span class="w"> </span><span class="nx">signPayment</span><span class="p">(</span><span class="nx">recipient</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">,</span><span class="w"> </span><span class="nx">nonce</span><span class="p">,</span><span class="w"> </span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0x&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">abi</span><span class="p">.</span><span class="nx">soliditySHA3</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;uint256&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;uint256&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;address&quot;</span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="nx">recipient</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">,</span><span class="w"> </span><span class="nx">nonce</span><span class="p">,</span><span class="w"> </span><span class="nx">contractAddress</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">personal</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">defaultAccount</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="solidity-de-imzalayani-bulma">
<h4>Solidity’de İmzalayanı Bulma<a class="headerlink" href="#solidity-de-imzalayani-bulma" title="Permalink to this heading"></a></h4>
<p>Genelde ECDSA imzaları iki parametreden oluşur, <code class="docutils literal notranslate"><span class="pre">r</span></code>
ve <code class="docutils literal notranslate"><span class="pre">s</span></code>. Ethereum’daki imzalar <code class="docutils literal notranslate"><span class="pre">v</span></code> denilen üçüncü bir
parametre daha içerir. <code class="docutils literal notranslate"><span class="pre">v</span></code> parametresi ile mesajı imzalamak
için kullanılmış cüzdanın gizli anahtarı doğrulanabiliyirsiniz.
Solidity <a class="reference internal" href="units-and-global-variables.html#mathematical-and-cryptographic-functions"><span class="std std-ref">ecrecover</span></a>
fonksiyonunu gömülü olarak sağlamaktadır. Bu fonksiyon mesajla birlikte
<code class="docutils literal notranslate"><span class="pre">r</span></code>, <code class="docutils literal notranslate"><span class="pre">s</span></code> ve <code class="docutils literal notranslate"><span class="pre">v</span></code> parametrelerini de alır ve mesajı imzalamak için
kullanılmış adresi verir.</p>
</section>
<section id="imza-parametrelerini-cikartma">
<h4>İmza Parametrelerini Çıkartma<a class="headerlink" href="#imza-parametrelerini-cikartma" title="Permalink to this heading"></a></h4>
<p>web3.js ile oluşturulmuş imzalar <code class="docutils literal notranslate"><span class="pre">r</span></code>, <code class="docutils literal notranslate"><span class="pre">s</span></code> ve <code class="docutils literal notranslate"><span class="pre">v</span></code>’in birleştirilmesi
ile oluşturulur, yani ilk adım bu parametreleri ayırmak. Bunu kullanıcı tarafında
da yapabilirsiniz ancak parametre ayırma işleminin akıllı kontratın içinde
olması akıllı kontrata üç parametre yerine sadece bir parametre göndermemizi sağlar.
Bir bayt dizisini (byte array) bileşenlerine ayırmak biraz karışık dolayısıyla bu
işlemi <code class="docutils literal notranslate"><span class="pre">splitSignature</span></code> fonksiyonunda yapmak için <a class="reference internal" href="assembly.html"><span class="doc">inline assembly</span></a>
kullanacağız. (Bu bölümün sonundaki tam kontrattaki üçüncü fonksiyon.)</p>
</section>
<section id="mesaj-hashini-hesaplama">
<h4>Mesaj Hashini Hesaplama<a class="headerlink" href="#mesaj-hashini-hesaplama" title="Permalink to this heading"></a></h4>
<p>Akıllı kontratın tam olarak hangi parametrelerin izalandığını bilmesi gerekiyor çünkü
kontratın imzzayı doğrulamak için mesajı parametrelerinden tekrar oluşturması lazım.
<code class="docutils literal notranslate"><span class="pre">claimPayment</span></code> fonksiyonundaki <code class="docutils literal notranslate"><span class="pre">prefixed</span></code> ve <code class="docutils literal notranslate"><span class="pre">recoverSigner</span></code> fonksiyonları bu işlemi
gerçekleştiriyor.</p>
</section>
<section id="tam-kontrat">
<h4>Tam Kontrat<a class="headerlink" href="#tam-kontrat" title="Permalink to this heading"></a></h4>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwpjb250cmFjdCBSZWNlaXZlclBheXMgewogICAgYWRkcmVzcyBvd25lciA9IG1zZy5zZW5kZXI7CgogICAgbWFwcGluZyh1aW50MjU2ID0+IGJvb2wpIHVzZWROb25jZXM7CgogICAgY29uc3RydWN0b3IoKSBwYXlhYmxlIHt9CgogICAgZnVuY3Rpb24gY2xhaW1QYXltZW50KHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IG5vbmNlLCBieXRlcyBtZW1vcnkgc2lnbmF0dXJlKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSghdXNlZE5vbmNlc1tub25jZV0pOwogICAgICAgIHVzZWROb25jZXNbbm9uY2VdID0gdHJ1ZTsKCiAgICAgICAgLy8gaXN0ZW1jaWRlIGltemFsYW5txLHFnyBtZXNhasSxIHRla3JhciBvbHXFn3R1cnVyLgogICAgICAgIGJ5dGVzMzIgbWVzc2FnZSA9IHByZWZpeGVkKGtlY2NhazI1NihhYmkuZW5jb2RlUGFja2VkKG1zZy5zZW5kZXIsIGFtb3VudCwgbm9uY2UsIHRoaXMpKSk7CgogICAgICAgIHJlcXVpcmUocmVjb3ZlclNpZ25lcihtZXNzYWdlLCBzaWduYXR1cmUpID09IG93bmVyKTsKCiAgICAgICAgcGF5YWJsZShtc2cuc2VuZGVyKS50cmFuc2ZlcihhbW91bnQpOwogICAgfQoKICAgIC8vLyBzw7Z6bGXFn21leWkgeW9rIGVkZXIgdmUga2FsYW4gcGFyYXnEsSBnZXJpIGFsxLFyCiAgICBmdW5jdGlvbiBzaHV0ZG93bigpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIHNlbGZkZXN0cnVjdChwYXlhYmxlKG1zZy5zZW5kZXIpKTsKICAgIH0KCiAgICAvLy8gaW16YSBtZXRob2RsYXLEsQogICAgZnVuY3Rpb24gc3BsaXRTaWduYXR1cmUoYnl0ZXMgbWVtb3J5IHNpZykKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykKICAgIHsKICAgICAgICByZXF1aXJlKHNpZy5sZW5ndGggPT0gNjUpOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIC8vIHV6dW5sdWsgw7ZuZWtpbmRlbiBzb25yYWtpIGlsayAzMiBiYXl0LgogICAgICAgICAgICByIDo9IG1sb2FkKGFkZChzaWcsIDMyKSkKICAgICAgICAgICAgLy8gaWtpbmNpIDMyIGJheXQKICAgICAgICAgICAgcyA6PSBtbG9hZChhZGQoc2lnLCA2NCkpCiAgICAgICAgICAgIC8vIHNvbiBiYXl0IChnZWxlY2VrIDMyIGJheXTEsW4gc29uIGJheXTEsSkKICAgICAgICAgICAgdiA6PSBieXRlKDAsIG1sb2FkKGFkZChzaWcsIDk2KSkpCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKHYsIHIsIHMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlY292ZXJTaWduZXIoYnl0ZXMzMiBtZXNzYWdlLCBieXRlcyBtZW1vcnkgc2lnKQogICAgICAgIGludGVybmFsCiAgICAgICAgcHVyZQogICAgICAgIHJldHVybnMgKGFkZHJlc3MpCiAgICB7CiAgICAgICAgKHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSA9IHNwbGl0U2lnbmF0dXJlKHNpZyk7CgogICAgICAgIHJldHVybiBlY3JlY292ZXIobWVzc2FnZSwgdiwgciwgcyk7CiAgICB9CgogICAgLy8vIGV0aF9zaWduJ2kga29weWFsYXlhbiDDtm7DvG5lIGVrbGVubWnFnyBoYXNoIG9sdcWfdHVydXIuCiAgICBmdW5jdGlvbiBwcmVmaXhlZChieXRlczMyIGhhc2gpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHJldHVybiBrZWNjYWsyNTYoYWJpLmVuY29kZVBhY2tlZCgiXHgxOUV0aGVyZXVtIFNpZ25lZCBNZXNzYWdlOlxuMzIiLCBoYXNoKSk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">ReceiverPays</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span>usedNonces<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">claimPayment</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">nonce</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>signature<span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="o">!</span>usedNonces<span class="p">[</span>nonce<span class="p">]);</span><span class="w"></span>
<span class="w">        </span>usedNonces<span class="p">[</span>nonce<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// istemcide imzalanmış mesajı tekrar oluşturur.</span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>prefixed<span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>amount<span class="p">,</span><span class="w"> </span>nonce<span class="p">,</span><span class="w"> </span><span class="kt">this</span><span class="p">)));</span><span class="w"></span>

<span class="w">        </span><span class="kt">require</span><span class="p">(</span>recoverSigner<span class="p">(</span>message<span class="p">,</span><span class="w"> </span>signature<span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">).</span>transfer<span class="p">(</span>amount<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// sözleşmeyi yok eder ve kalan parayı geri alır</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">shutdown</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">);</span><span class="w"></span>
<span class="w">        </span>selfdestruct<span class="p">(</span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// imza methodları</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">splitSignature</span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>sig<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">internal</span><span class="w"></span>
<span class="w">        </span>pure<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">v</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">r</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>sig<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">65</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span>assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// uzunluk önekinden sonraki ilk 32 bayt.</span>
<span class="w">            </span>r<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>mload<span class="p">(</span>add<span class="p">(</span>sig<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">32</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="c1">// ikinci 32 bayt</span>
<span class="w">            </span>s<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>mload<span class="p">(</span>add<span class="p">(</span>sig<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">64</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="c1">// son bayt (gelecek 32 baytın son baytı)</span>
<span class="w">            </span>v<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>byte<span class="p">(</span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span>mload<span class="p">(</span>add<span class="p">(</span>sig<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">96</span><span class="p">)))</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span>v<span class="p">,</span><span class="w"> </span>r<span class="p">,</span><span class="w"> </span>s<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">recoverSigner</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>sig<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">internal</span><span class="w"></span>
<span class="w">        </span>pure<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">v</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">r</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>splitSignature<span class="p">(</span>sig<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">return</span><span class="w"> </span>ecrecover<span class="p">(</span>message<span class="p">,</span><span class="w"> </span>v<span class="p">,</span><span class="w"> </span>r<span class="p">,</span><span class="w"> </span>s<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// eth_sign&#39;i kopyalayan önüne eklenmiş hash oluşturur.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">prefixed</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">hash</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="s2">&quot;\x19Ethereum Signed Message:\n32&quot;</span><span class="p">,</span><span class="w"> </span><span class="kt">hash</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="basit-bir-odeme-kanali-yazmak">
<h3>Basit Bir Ödeme Kanalı Yazmak<a class="headerlink" href="#basit-bir-odeme-kanali-yazmak" title="Permalink to this heading"></a></h3>
<p>Alice şimdi ödeme basit ama tam işlevsel bir ödeme kanalı oluşturacak.
Ödeme kanalları anında ve masrafsız tekrarlayan Ether transferleri gerçekleştirmek
için kriptografik imzaları kullanırlar.</p>
<section id="odeme-kanali-nedir">
<h4>Ödeme Kanalı Nedir?<a class="headerlink" href="#odeme-kanali-nedir" title="Permalink to this heading"></a></h4>
<p>Ödeme kanalları katılımcıların herhangi bir işlem gerçekleştirmeden
tekrarlayan Ether transferleri gerçekleştirmelerini sağlar. Bu sayesede
ödemeyle ilgili gecikme ve masraflardan kurtulabilirsiniz. Şimdi iki kişi
(Alice ve Bob) arasında tek yönlü bir ödeme kanalı nasıl oluşturul onu göreceğiz.
Böyle bir sistemi 3 adımda oluşturabiliriz. Bunlar:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Alice ödeme kanalına Ether yükler böylece ödeme kanali “açık” hale gelir.</p></li>
<li><p>Alice ne kadar Ether’in ödenmesi gerektiğini bir mesajda belirtir. Bu adım her ödemede tekrar gerçekleştirilir.</p></li>
<li><p>Bob Ether ödemesini alıp kalanı geri göndererek ödeme kanalını kapatır.</p></li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sadece 1. ve 3. adımlar Ethereum işlemi gerektiriyor. 2. adımda gönderici
kriptografik olarak imzalanmış mesajı alıcıya zincir dışı (off-chain) bir
şekilde (mesela e-posta) gönderebilir. Kısaca herhangi bir sayıda transfer için
2 Ethereum işlemi gerekiyor.</p>
</div>
<p>Bob kesinlikle parasını alacak çünkü Ether bir akıllı kontratta tutuluyor ve
geçerli bir imzalı mesaj ile akıllı kontratlar her zaman işlemi gerçekleştirir.
Akıllı kontrat ayrıca zaman aşımını da zorunlu tutar, yani alıcı parası almazsa
Alice eninde sonunda parasını geri alabilir. Zaman aşımının süresine katılımcılar
kendi karar verir. İnternet kafedeki kullanım süresi gibi kısa süreli bir işlem için,
ödeme kanalı süreli bir şekilde oluşturulabilir. Diğer bir yandan, bir çalışana saatlik
maaşını ödemek gibi tekrarlayan bir ödeme için ödeme kanalı bir kaç ay ya da yıl açık kalabilir.</p>
</section>
<section id="odeme-kanalini-acma">
<h4>Ödeme Kanalını Açma<a class="headerlink" href="#odeme-kanalini-acma" title="Permalink to this heading"></a></h4>
<p>Ödeme kanalını açmak için Alice içine gerekli Ether’i ekleyip ve alıcının
kim olduğunu girerek akıllı kontratı yayınlar. Bu işlemi bölümün sonundaki kontratta
<code class="docutils literal notranslate"><span class="pre">SimplePaymentChannel</span></code> fonksiyonu gerçekleştirir.</p>
</section>
<section id="odeme-gerceklestirme">
<h4>Ödeme Gerçekleştirme<a class="headerlink" href="#odeme-gerceklestirme" title="Permalink to this heading"></a></h4>
<p>Alice ödemeyi Bob’a imzalanmış mesajı göndererek yapar. Bu adım tamammiyle
Etherum ağının dışında gerçekeleşir. Mesaj gönderici tarafında kriptografik olarak imzalanır ve direkt
olarak alıcıya gönderilir.</p>
<p>Her mesaj aşağıdaki bilgileri içerir:</p>
<blockquote>
<div><ul class="simple">
<li><p>Akıllı kontratın adresi, kontratlar arası tekrarlama saldırılarını önlemek için.</p></li>
<li><p>Alıcıya borçlu olunan Ether miktarı.</p></li>
</ul>
</div></blockquote>
<p>Ödeme kanalı bütün transferler gerçekleştikten sonra sadece bir kez kapanır.
Bundan dolayı sadece bir mesajın ödemesi gerçekleşir. Bu yüzden her mesaj küçük ödemeler
yerine toplam gönderilmesi gereken Ether miktarını içerir. Alıcı doğal olarak en yüksek miktarı
alabilmek için en güncel mesajın ödemesini alır. Artık akıllı kontrat sadece bir mesaj okuduğunderstan
artık işlem sayısını (nonce) mesaja eklemeye gerek yok ancak akıllı kontratın adresine mesajın başka bir
ödeme kanalında kullanılmaması için hala ihtiyaç var.</p>
<p>Aşağıda önceki bölümdeki mesajın kriptografik imzalanmasını sağlayan JavaScript kodunun düzenlenmiş bir halini bulabilirsiniz.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="w"> </span><span class="nx">constructPaymentMessage</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">abi</span><span class="p">.</span><span class="nx">soliditySHA3</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;uint256&quot;</span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">signMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">personal</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;0x&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">defaultAccount</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nx">callback</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// contractAddress, kontratlar arası tekrarlama saldırısını engellemek için kontrat adresi</span><span class="w"></span>
<span class="c1">// amount, wei cinsinden, ne kadar gönderilmesi gerektiği</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">signPayment</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">constructPaymentMessage</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nx">signMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="odeme-kanalini-kapatma">
<h4>Ödeme Kanalını Kapatma<a class="headerlink" href="#odeme-kanalini-kapatma" title="Permalink to this heading"></a></h4>
<p>Bob ödemesini almaya hazır olduğunda ödeme kanalını da <code class="docutils literal notranslate"><span class="pre">close</span></code> fonksiyonunu
çağırarak kapatmanın vakti de gelmiş demektir. Kanal kapatıldığında alıcı kendine borçlu
olunan Ether miktarını alır ve kalan miktarı Alice’e geri göndererek kontratı yok eder.
Bob sadece Alice tarafında imzalanmış bir mesaj ile kanalı kapatabilir.</p>
<p>Akıllı kontratın göndericiden gelen geçerli bir mesajı doğrulaması gerekir. Bu doğrulama süreci
alıcının kullandığı süreç ile aynıdır. Solidity fonksiyonlarından <code class="docutils literal notranslate"><span class="pre">isValidSignature</span></code> ve <code class="docutils literal notranslate"><span class="pre">recoverSigner</span></code> (<code class="docutils literal notranslate"><span class="pre">ReceiverPays</span></code> kontratından aldık)
önceki bölümdeki JavaScript hallerindekiyle aynı şekilde çalışır.</p>
<p>Sadece ödeme kanalının alıcısı <code class="docutils literal notranslate"><span class="pre">close</span></code> fonksiyonunu çağırabilir. Alıcı da doğal olarak en yüksek miktarı
taşığı için en güncel mesajı gönderir. Eğer gönderici bu mesajı çağırabiliyor olsaydı daha düşük bir miktar içeren bir mesaj
ile çağırıp, ödemeleri gerekenden daha düşük bir para göndererek hile yapabilirlerdi.</p>
<p>Fonksiyon verilen parametreler ile imzalanmış mesajı doğrular. Eğer her şey uygunsa, alıcıya kendi payına düşen
Ether miktarı gönderilir ve göndericiye kalan miktar <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code> ile gönderilir. Tam kontratta <code class="docutils literal notranslate"><span class="pre">close</span></code> fonksiyonunu görebilirsiniz.</p>
</section>
<section id="kanalin-zaman-asimina-ugramasi">
<h4>Kanalın Zaman Aşımına Uğraması<a class="headerlink" href="#kanalin-zaman-asimina-ugramasi" title="Permalink to this heading"></a></h4>
<p>Bob istediği zaman ödeme kanalını kapatabilir anca kapatmazsa Alice’in bir
şekilde parasını geri alması gerekiyor. Bunun için kontrata bir <em>zaman aşımı</em>
süresi girilir. Süre dolduğunda, Alice <code class="docutils literal notranslate"><span class="pre">claimTimeout</span></code> fonksiyonunu çağırarak
içerideki parasını geri alabilir. <code class="docutils literal notranslate"><span class="pre">claimTimeout</span></code> fonksyionunu tam kontratta görebilirsiniz.</p>
<p>Bu fonksiyon çağırıldıktan sonra Bob artık sistemden Ether alamaz dolayısıyla Bob’un zaman aşımına
uğramadan parasını alması oldukça önemli.</p>
</section>
<section id="id7">
<h4>Tam Kontrat<a class="headerlink" href="#id7" title="Permalink to this heading"></a></h4>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwpjb250cmFjdCBTaW1wbGVQYXltZW50Q2hhbm5lbCB7CiAgICBhZGRyZXNzIHBheWFibGUgcHVibGljIHNlbmRlcjsgICAgICAvLyBnw7ZuZGVyaWNpbmluIGFkcmVzaS4KICAgIGFkZHJlc3MgcGF5YWJsZSBwdWJsaWMgcmVjaXBpZW50OyAgIC8vIGFsxLFjxLFuxLFuIGFkcmVzaS4KICAgIHVpbnQyNTYgcHVibGljIGV4cGlyYXRpb247ICAvLyBrYXBhbm1hbWFzxLEgZHVydW11bmRhIHphbWFuIGHFn8SxbcSxIHPDvHJlc2kuCgogICAgY29uc3RydWN0b3IgKGFkZHJlc3MgcGF5YWJsZSByZWNpcGllbnRBZGRyZXNzLCB1aW50MjU2IGR1cmF0aW9uKQogICAgICAgIHBheWFibGUKICAgIHsKICAgICAgICBzZW5kZXIgPSBwYXlhYmxlKG1zZy5zZW5kZXIpOwogICAgICAgIHJlY2lwaWVudCA9IHJlY2lwaWVudEFkZHJlc3M7CiAgICAgICAgZXhwaXJhdGlvbiA9IGJsb2NrLnRpbWVzdGFtcCArIGR1cmF0aW9uOwogICAgfQoKICAgIC8vLyBhbMSxY8SxLCBnw7ZuZGVyaWNpbmluIGltemFsxLEgbWVzYWrEsSBpbGUgaXN0ZWRpxJ9pIHphbWFuIGthbmFsxLEga2FwYXRhYmlsaXIuCiAgICAvLy8gYWzEsWPEsSBhbGFjYWtsxLFzxLEgb2xkdcSfdSBtaWt0YXLEsSBhbMSxcAogICAgLy8vIGthbGFuxLEgZ8O2bmRlcmljaXllIGdlcmkgZ8O2bmRlcmlyLgogICAgZnVuY3Rpb24gY2xvc2UodWludDI1NiBhbW91bnQsIGJ5dGVzIG1lbW9yeSBzaWduYXR1cmUpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcmVjaXBpZW50KTsKICAgICAgICByZXF1aXJlKGlzVmFsaWRTaWduYXR1cmUoYW1vdW50LCBzaWduYXR1cmUpKTsKCiAgICAgICAgcmVjaXBpZW50LnRyYW5zZmVyKGFtb3VudCk7CiAgICAgICAgc2VsZmRlc3RydWN0KHNlbmRlcik7CiAgICB9CgogICAgLy8vIGfDtm5kZXJpY2kgemFtYW4gYcWfxLFtxLEgc8O8cmVzaW5pIGlzdGVkacSfaSB6YW1hbiBhcnR0xLFyYWJpbGlyCiAgICBmdW5jdGlvbiBleHRlbmQodWludDI1NiBuZXdFeHBpcmF0aW9uKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbmRlcik7CiAgICAgICAgcmVxdWlyZShuZXdFeHBpcmF0aW9uID4gZXhwaXJhdGlvbik7CgogICAgICAgIGV4cGlyYXRpb24gPSBuZXdFeHBpcmF0aW9uOwogICAgfQoKICAgIC8vLyBFxJ9lciBzw7xyZSBhbMSxY8SxIGthbmFsxLEga2FwYXRtYWRhbiBkb2xhcnNhCiAgICAvLy8gRXRoZXIgZ8O2bmRlcmljaXllIGdlcmkgZMO2bmVyCiAgICBmdW5jdGlvbiBjbGFpbVRpbWVvdXQoKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPj0gZXhwaXJhdGlvbik7CiAgICAgICAgc2VsZmRlc3RydWN0KHNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gaXNWYWxpZFNpZ25hdHVyZSh1aW50MjU2IGFtb3VudCwgYnl0ZXMgbWVtb3J5IHNpZ25hdHVyZSkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGJ5dGVzMzIgbWVzc2FnZSA9IHByZWZpeGVkKGtlY2NhazI1NihhYmkuZW5jb2RlUGFja2VkKHRoaXMsIGFtb3VudCkpKTsKCiAgICAgICAgLy8gaW16YW7EsW4gZ8O2bmRlcmljaWRlbiBnZWxkacSfaW5pIGtvbnRyb2wgZXQKICAgICAgICByZXR1cm4gcmVjb3ZlclNpZ25lcihtZXNzYWdlLCBzaWduYXR1cmUpID09IHNlbmRlcjsKICAgIH0KCiAgICAvLy8gQcWfYcSfxLFkYWtpIHTDvG0ga29ua3N5aW9ubGFyICdpbXphIG9sdcWfdHVybWEgdmUgZG/En3J1bGFtYScKICAgIC8vLyBiw7Zsw7xtw7xuZGVuIGFsxLFuZMSxLgoKICAgIGZ1bmN0aW9uIHNwbGl0U2lnbmF0dXJlKGJ5dGVzIG1lbW9yeSBzaWcpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAodWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpCiAgICB7CiAgICAgICAgcmVxdWlyZShzaWcubGVuZ3RoID09IDY1KTsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvLyB1enVubHVrIMO2bmVraW5kZW4gc29ucmFraSBpbGsgMzIgYmF5dC4KICAgICAgICAgICAgciA6PSBtbG9hZChhZGQoc2lnLCAzMikpCiAgICAgICAgICAgIC8vIGlraW5jaSAzMiBiYXl0CiAgICAgICAgICAgIHMgOj0gbWxvYWQoYWRkKHNpZywgNjQpKQogICAgICAgICAgICAvLyBzb24gYmF5dCAoZ2VsZWNlayAzMiBiYXl0xLFuIHNvbiBiYXl0xLEpCiAgICAgICAgICAgIHYgOj0gYnl0ZSgwLCBtbG9hZChhZGQoc2lnLCA5NikpKQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICh2LCByLCBzKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWNvdmVyU2lnbmVyKGJ5dGVzMzIgbWVzc2FnZSwgYnl0ZXMgbWVtb3J5IHNpZykKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zIChhZGRyZXNzKQogICAgewogICAgICAgICh1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgPSBzcGxpdFNpZ25hdHVyZShzaWcpOwoKICAgICAgICByZXR1cm4gZWNyZWNvdmVyKG1lc3NhZ2UsIHYsIHIsIHMpOwogICAgfQoKICAgIC8vLyBldGhfc2lnbidpIGtvcHlhbGF5YW4gw7Zuw7xuZSBla2xlbm1pxZ8gaGFzaCBvbHXFn3R1cnVyLgogICAgZnVuY3Rpb24gcHJlZml4ZWQoYnl0ZXMzMiBoYXNoKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICByZXR1cm4ga2VjY2FrMjU2KGFiaS5lbmNvZGVQYWNrZWQoIlx4MTlFdGhlcmV1bSBTaWduZWQgTWVzc2FnZTpcbjMyIiwgaGFzaCkpOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">SimplePaymentChannel</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>sender<span class="p">;</span><span class="w">      </span><span class="c1">// göndericinin adresi.</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>recipient<span class="p">;</span><span class="w">   </span><span class="c1">// alıcının adresi.</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="k">public </span><span class="nv">expiration</span><span class="p">;</span><span class="w">  </span><span class="c1">// kapanmaması durumunda zaman aşımı süresi.</span>

<span class="w">    </span><span class="kt">constructor</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>recipientAddress<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">duration</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">payable</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>sender<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>recipient<span class="w"> </span><span class="o">=</span><span class="w"> </span>recipientAddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span>expiration<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>duration<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// alıcı, göndericinin imzalı mesajı ile istediği zaman kanalı kapatabilir.</span>
<span class="w">    </span><span class="c1">/// alıcı alacaklısı olduğu miktarı alıp</span>
<span class="w">    </span><span class="c1">/// kalanı göndericiye geri gönderir.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">close</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>signature<span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>recipient<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>isValidSignature<span class="p">(</span>amount<span class="p">,</span><span class="w"> </span>signature<span class="p">));</span><span class="w"></span>

<span class="w">        </span>recipient<span class="p">.</span>transfer<span class="p">(</span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span>selfdestruct<span class="p">(</span>sender<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// gönderici zaman aşımı süresini istediği zaman arttırabilir</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">extend</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">newExpiration</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>sender<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>newExpiration<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>expiration<span class="p">);</span><span class="w"></span>

<span class="w">        </span>expiration<span class="w"> </span><span class="o">=</span><span class="w"> </span>newExpiration<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Eğer süre alıcı kanalı kapatmadan dolarsa</span>
<span class="w">    </span><span class="c1">/// Ether göndericiye geri döner</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">claimTimeout</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>expiration<span class="p">);</span><span class="w"></span>
<span class="w">        </span>selfdestruct<span class="p">(</span>sender<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">isValidSignature</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>signature<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">internal</span><span class="w"></span>
<span class="w">        </span>view<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>prefixed<span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="kt">this</span><span class="p">,</span><span class="w"> </span>amount<span class="p">)));</span><span class="w"></span>

<span class="w">        </span><span class="c1">// imzanın göndericiden geldiğini kontrol et</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>recoverSigner<span class="p">(</span>message<span class="p">,</span><span class="w"> </span>signature<span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>sender<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Aşağıdaki tüm konksyionlar &#39;imza oluşturma ve doğrulama&#39;</span>
<span class="w">    </span><span class="c1">/// bölümünden alındı.</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">splitSignature</span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>sig<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">internal</span><span class="w"></span>
<span class="w">        </span>pure<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">v</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">r</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>sig<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">65</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span>assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// uzunluk önekinden sonraki ilk 32 bayt.</span>
<span class="w">            </span>r<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>mload<span class="p">(</span>add<span class="p">(</span>sig<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">32</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="c1">// ikinci 32 bayt</span>
<span class="w">            </span>s<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>mload<span class="p">(</span>add<span class="p">(</span>sig<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">64</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="c1">// son bayt (gelecek 32 baytın son baytı)</span>
<span class="w">            </span>v<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>byte<span class="p">(</span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span>mload<span class="p">(</span>add<span class="p">(</span>sig<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">96</span><span class="p">)))</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span>v<span class="p">,</span><span class="w"> </span>r<span class="p">,</span><span class="w"> </span>s<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">recoverSigner</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>sig<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">internal</span><span class="w"></span>
<span class="w">        </span>pure<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">v</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">r</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>splitSignature<span class="p">(</span>sig<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">return</span><span class="w"> </span>ecrecover<span class="p">(</span>message<span class="p">,</span><span class="w"> </span>v<span class="p">,</span><span class="w"> </span>r<span class="p">,</span><span class="w"> </span>s<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// eth_sign&#39;i kopyalayan önüne eklenmiş hash oluşturur.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">prefixed</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">hash</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="s2">&quot;\x19Ethereum Signed Message:\n32&quot;</span><span class="p">,</span><span class="w"> </span><span class="kt">hash</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">splitSignature</span></code> fonksiyonu bütün güvenlik önlemlerini almıyor. Gerçek bir uygulamada
openzeppelin’in <a class="reference external" href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/cryptography/ECDSA.sol">versionu</a>
gibi daha iyi test edilmiş bir kütüphane kullanılmalı.</p>
</div>
</section>
<section id="odemeleri-dogrulama">
<h4>Ödemeleri Doğrulama<a class="headerlink" href="#odemeleri-dogrulama" title="Permalink to this heading"></a></h4>
<p>Önceki bölümlerdekinin aksine, ödeme kanalındaki mesajlar anında alınmamakta.
Alıcı mesajların takibini yapıp zamanı geldiğinde ödeme kanalını kapatır. Yani bu durumda
alıcının mesajları kendisinin doğrulaması oldukça önemli. Yoksa alıcının ödemesini kesin alacağının
bir garantisi yok.</p>
<p>Alıcı her mesajı aşağıdaki işlemler ile doğrulamalı:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Mesajdaki kontrat adresinin ödeme kanalı ile aynı olduğunu kontrol et</p></li>
<li><p>Yeni toplam miktarın beklenen miktar ile aynı olduğunu kontrol et</p></li>
<li><p>Yeni toplam miktarın kontrattakinden fazla olmadığını kontrol et</p></li>
<li><p>Mesajın ödeme kanalının göndericisinden geldiğini kontrol et.</p></li>
</ol>
</div></blockquote>
<p>Bu doğrulamayı yazmak için <a class="reference external" href="https://github.com/ethereumjs/ethereumjs-util">ethereumjs-util</a>
kütüphanesini kullanacağız. Son adım için bir çok farklı yol var ve biz JavaScript kullanacağuz.
Aşağıdaki kod  <code class="docutils literal notranslate"><span class="pre">constructPaymentMessage</span></code> fonksiyonunu yukarıdaki imzalama <strong>JavaScript kodundan</strong> ödünç alıyor:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Bu eth_sign JSON-RPC metodunun ön ekleme özelliğini taklit eder.</span><span class="w"></span>
<span class="kd">function</span><span class="w"> </span><span class="nx">prefixed</span><span class="p">(</span><span class="nx">hash</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ethereumjs</span><span class="p">.</span><span class="nx">ABI</span><span class="p">.</span><span class="nx">soliditySHA3</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bytes32&quot;</span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;\x19Ethereum Signed Message:\n32&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">hash</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">recoverSigner</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">signature</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">split</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ethereumjs</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">fromRpcSig</span><span class="p">(</span><span class="nx">signature</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">publicKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ethereumjs</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">ecrecover</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">split</span><span class="p">.</span><span class="nx">v</span><span class="p">,</span><span class="w"> </span><span class="nx">split</span><span class="p">.</span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">split</span><span class="p">.</span><span class="nx">s</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">signer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ethereumjs</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">pubToAddress</span><span class="p">(</span><span class="nx">publicKey</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">signer</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">isValidSignature</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">,</span><span class="w"> </span><span class="nx">signature</span><span class="p">,</span><span class="w"> </span><span class="nx">expectedSigner</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prefixed</span><span class="p">(</span><span class="nx">constructPaymentMessage</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">signer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">recoverSigner</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">signature</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">signer</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"></span>
<span class="w">        </span><span class="nx">ethereumjs</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">stripHexPrefix</span><span class="p">(</span><span class="nx">expectedSigner</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="moduler-kontratlar">
<span id="index-3"></span><h2>Modüler Kontratlar<a class="headerlink" href="#moduler-kontratlar" title="Permalink to this heading"></a></h2>
<p>Kontratları oluştururken modüler bir yaklaşım izlemek kodların karışıklığını
azaltıp, okunabilirliğini arttırır. Bu durumda hataların ve açıkların daha
kolay bir şekilde bulunmasını sağlar.
Eğer her modülün nasıl davranacağını izole bir şekilde tanımlar ve kontrol ederseniz,
sadece bütün kontratta olup biten yerine o kontratlar arasındaki ilişkileri inceleyebilirsiniz.
Aşağıdaki örnekte kontrat adresler arasında gönderilenin beklenen şekilde olup olmadığını
görmek için <code class="docutils literal notranslate"><span class="pre">Balances</span></code> <a class="reference internal" href="contracts.html#libraries"><span class="std std-ref">library</span></a> kütüphanesinin <code class="docutils literal notranslate"><span class="pre">move</span></code> metodunu kullanır.
<code class="docutils literal notranslate"><span class="pre">Balances</span></code> kütüphanesinin asla nefatif bir bakiye çıkarmadığı ya da bütün bakiyelerin toplamından
overflow yaratmayacağı kolaylıkla doğrulanabilir ve bu durum kontratın yaşam süresi boyunca değişmez.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjAgPDAuOS4wOwoKbGlicmFyeSBCYWxhbmNlcyB7CiAgICBmdW5jdGlvbiBtb3ZlKG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBzdG9yYWdlIGJhbGFuY2VzLCBhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgYW1vdW50KSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tmcm9tXSA+PSBhbW91bnQpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbdG9dICsgYW1vdW50ID49IGJhbGFuY2VzW3RvXSk7CiAgICAgICAgYmFsYW5jZXNbZnJvbV0gLT0gYW1vdW50OwogICAgICAgIGJhbGFuY2VzW3RvXSArPSBhbW91bnQ7CiAgICB9Cn0KCmNvbnRyYWN0IFRva2VuIHsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIHVzaW5nIEJhbGFuY2VzIGZvciAqOwogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQgYW1vdW50KTsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IGFtb3VudCkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYmFsYW5jZXMubW92ZShtc2cuc2VuZGVyLCB0bywgYW1vdW50KTsKICAgICAgICBlbWl0IFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCBhbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwoKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IGFtb3VudCkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShhbGxvd2VkW2Zyb21dW21zZy5zZW5kZXJdID49IGFtb3VudCk7CiAgICAgICAgYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSAtPSBhbW91bnQ7CiAgICAgICAgYmFsYW5jZXMubW92ZShmcm9tLCB0bywgYW1vdW50KTsKICAgICAgICBlbWl0IFRyYW5zZmVyKGZyb20sIHRvLCBhbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHRva2VucykgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID09IDAsICIiKTsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gdG9rZW5zOwogICAgICAgIGVtaXQgQXBwcm92YWwobXNnLnNlbmRlciwgc3BlbmRlciwgdG9rZW5zKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB0b2tlbk93bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1t0b2tlbk93bmVyXTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.5.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">library</span><span class="w"> </span>Balances<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">move</span><span class="p">(</span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span>storage<span class="w"> </span>balances<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">from</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>balances<span class="p">[</span>from<span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>balances<span class="p">[</span>to<span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>amount<span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>balances<span class="p">[</span>to<span class="p">]);</span><span class="w"></span>
<span class="w">        </span>balances<span class="p">[</span>from<span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">        </span>balances<span class="p">[</span>to<span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Token</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span>balances<span class="p">;</span><span class="w"></span>
<span class="w">    </span>using<span class="w"> </span>Balances<span class="w"> </span><span class="kt">for</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">))</span><span class="w"> </span>allowed<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Transfer</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">from</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Approval</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">owner</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">spender</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">transfer</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>balances<span class="p">.</span>move<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>Transfer<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">transferFrom</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">from</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>allowed<span class="p">[</span>from<span class="p">][</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span>allowed<span class="p">[</span>from<span class="p">][</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">        </span>balances<span class="p">.</span>move<span class="p">(</span>from<span class="p">,</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>Transfer<span class="p">(</span>from<span class="p">,</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">approve</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">spender</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">tokens</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>allowed<span class="p">[</span><span class="k">msg.sender</span><span class="p">][</span>spender<span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>allowed<span class="p">[</span><span class="k">msg.sender</span><span class="p">][</span>spender<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tokens<span class="p">;</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>Approval<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>spender<span class="p">,</span><span class="w"> </span>tokens<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">balanceOf</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">tokenOwner</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">balance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>balances<span class="p">[</span>tokenOwner<span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installing-solidity.html" class="btn btn-neutral float-left" title="Solidity Derleyicisini Yükleme" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="layout-of-source-files.html" class="btn btn-neutral float-right" title="Solidity Kaynak Dosyasının Düzeni" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2021, Ethereum.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
    <p>
        <a href="credits-and-attribution.html">Credits and attribution</a>.
    </p>


</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book fa-element"> RTD </span>

    <span class="fa fa-element">
    <input class="container_toggle" type="checkbox" id="switch" name="mode">
    <label for="switch"></label>
    </span>

    <span class="fa fa-v fa-element"> v:  <span class="fa fa-caret-down"></span></span>

    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Downloads</dt> 
        </dl>
        <dl>
            <dt>Versions</dt> 
        </dl>
        <dl>
            
            <dt>On Read the Docs</dt>
            <dd>
                <a href="///projects//?fromdocs=">Project Home</a>
            </dd>
            <dd>
                <a href="///builds//?fromdocs=">Builds</a>
            </dd>
        </dl>
    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>